-- VAPE UI Library v1.0.0
-- 专为Roblox脚本中心设计，面向手机端优化
-- GitHub: https://github.com/yourusername/vape-ui

local VapeUI = {}
VapeUI.__index = VapeUI
VapeUI.Version = "1.0.0"

-- 常量定义
local COLORS = {
    BACKGROUND = Color3.fromRGB(30, 30, 40),
    SECONDARY = Color3.fromRGB(40, 40, 50),
    ACCENT = Color3.fromRGB(0, 162, 255),
    TEXT = Color3.fromRGB(255, 255, 255),
    SUBTEXT = Color3.fromRGB(200, 200, 200),
    SUCCESS = Color3.fromRGB(0, 200, 100),
    WARNING = Color3.fromRGB(255, 180, 0),
    ERROR = Color3.fromRGB(255, 80, 80),
    BORDER = Color3.fromRGB(60, 60, 70)
}

local FONTS = {
    TITLE = Enum.Font.GothamBold,
    HEADER = Enum.Font.GothamSemibold,
    BODY = Enum.Font.Gotham,
    MONO = Enum.Font.Code
}

local SIZES = {
    TAB_HEIGHT = 35,
    OPTION_HEIGHT = 40,
    SETTING_HEIGHT = 30,
    PADDING = 5,
    BORDER_RADIUS = 4
}

-- 工具函数
local function CreateUICorner(radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius)
    return corner
end

local function CreateUIPadding(padding)
    local uiPadding = Instance.new("UIPadding")
    uiPadding.PaddingLeft = UDim.new(0, padding)
    uiPadding.PaddingRight = UDim.new(0, padding)
    uiPadding.PaddingTop = UDim.new(0, padding)
    uiPadding.PaddingBottom = UDim.new(0, padding)
    return uiPadding
end

local function CreateUIStroke(thickness, color)
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = thickness
    stroke.Color = color
    stroke.LineJoinMode = Enum.LineJoinMode.Round
    return stroke
end

local function Tween(object, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(duration or 0.2, easingStyle or Enum.EasingStyle.Quad, easingDirection or Enum.EasingDirection.Out)
    local tween = game:GetService("TweenService"):Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

-- 主UI类
function VapeUI.new(options)
    options = options or {}
    local self = setmetatable({}, VapeUI)
    
    -- 配置
    self.config = {
        title = options.title or "VAPE",
        version = options.version or "1.0.0",
        theme = options.theme or "dark",
        position = options.position or UDim2.new(0.5, -150, 0.5, -200),
        size = options.size or UDim2.new(0, 300, 0, 400),
        mobileOptimized = options.mobileOptimized ~= false,
        draggable = options.draggable ~= false,
        savePosition = options.savePosition ~= false
    }
    
    -- 状态
    self.isVisible = false
    self.currentTab = nil
    self.tabs = {}
    self.options = {}
    self.settingsPanels = {}
    self.eventListeners = {}
    
    -- 创建UI
    self:CreateUI()
    self:SetupDrag()
    self:SetupEvents()
    
    return self
end

-- 创建主UI
function VapeUI:CreateUI()
    -- 创建ScreenGui
    self.screenGui = Instance.new("ScreenGui")
    self.screenGui.Name = "VapeUI"
    self.screenGui.ResetOnSpawn = false
    self.screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.screenGui.DisplayOrder = 999
    self.screenGui.Enabled = false
    
    -- 创建主容器
    self.mainContainer = Instance.new("Frame")
    self.mainContainer.Name = "MainContainer"
    self.mainContainer.Size = self.config.size
    self.mainContainer.Position = self.config.position
    self.mainContainer.BackgroundColor3 = COLORS.BACKGROUND
    self.mainContainer.BackgroundTransparency = 0.1
    self.mainContainer.BorderSizePixel = 0
    self.mainContainer.ClipsDescendants = true
    self.mainContainer.Parent = self.screenGui
    
    -- 圆角
    local corner = CreateUICorner(SIZES.BORDER_RADIUS * 2)
    corner.Parent = self.mainContainer
    
    -- 边框
    local stroke = CreateUIStroke(1, COLORS.BORDER)
    stroke.Parent = self.mainContainer
    
    -- 标题栏
    self.titleBar = Instance.new("Frame")
    self.titleBar.Name = "TitleBar"
    self.titleBar.Size = UDim2.new(1, 0, 0, 40)
    self.titleBar.BackgroundColor3 = COLORS.SECONDARY
    self.titleBar.BorderSizePixel = 0
    self.titleBar.Parent = self.mainContainer
    
    local titleCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    titleCorner.CornerRadius = UDim.new(0, SIZES.BORDER_RADIUS * 2)
    titleCorner.Parent = self.titleBar
    
    -- 标题
    self.titleLabel = Instance.new("TextLabel")
    self.titleLabel.Name = "Title"
    self.titleLabel.Text = self.config.title
    self.titleLabel.Font = FONTS.TITLE
    self.titleLabel.TextSize = 18
    self.titleLabel.TextColor3 = COLORS.TEXT
    self.titleLabel.BackgroundTransparency = 1
    self.titleLabel.Size = UDim2.new(1, -80, 1, 0)
    self.titleLabel.Position = UDim2.new(0, 10, 0, 0)
    self.titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    self.titleLabel.Parent = self.titleBar
    
    -- 版本标签
    self.versionLabel = Instance.new("TextLabel")
    self.versionLabel.Name = "Version"
    self.versionLabel.Text = "v" .. self.config.version
    self.versionLabel.Font = FONTS.BODY
    self.versionLabel.TextSize = 12
    self.versionLabel.TextColor3 = COLORS.SUBTEXT
    self.versionLabel.BackgroundTransparency = 1
    self.versionLabel.Size = UDim2.new(0, 40, 0, 20)
    self.versionLabel.Position = UDim2.new(1, -45, 0.5, -10)
    self.versionLabel.TextXAlignment = Enum.TextXAlignment.Right
    self.versionLabel.Parent = self.titleBar
    
    -- 设置按钮
    self.settingsButton = Instance.new("ImageButton")
    self.settingsButton.Name = "SettingsButton"
    self.settingsButton.Size = UDim2.new(0, 30, 0, 30)
    self.settingsButton.Position = UDim2.new(1, -40, 0.5, -15)
    self.settingsButton.BackgroundTransparency = 1
    self.settingsButton.Image = "rbxassetid://7072725343" -- 齿轮图标
    self.settingsButton.ImageColor3 = COLORS.SUBTEXT
    self.settingsButton.Parent = self.titleBar
    
    -- 关闭按钮
    self.closeButton = Instance.new("TextButton")
    self.closeButton.Name = "CloseButton"
    self.closeButton.Text = "×"
    self.closeButton.Font = Enum.Font.GothamBold
    self.closeButton.TextSize = 20
    self.closeButton.TextColor3 = COLORS.SUBTEXT
    self.closeButton.BackgroundTransparency = 1
    self.closeButton.Size = UDim2.new(0, 30, 0, 30)
    self.closeButton.Position = UDim2.new(1, -10, 0, 5)
    self.closeButton.Parent = self.titleBar
    
    -- 内容区域
    self.contentFrame = Instance.new("Frame")
    self.contentFrame.Name = "ContentFrame"
    self.contentFrame.Size = UDim2.new(1, 0, 1, -40)
    self.contentFrame.Position = UDim2.new(0, 0, 0, 40)
    self.contentFrame.BackgroundTransparency = 1
    self.contentFrame.Parent = self.mainContainer
    
    -- 左侧标签栏
    self.tabContainer = Instance.new("ScrollingFrame")
    self.tabContainer.Name = "TabContainer"
    self.tabContainer.Size = UDim2.new(0.3, 0, 1, 0)
    self.tabContainer.BackgroundColor3 = COLORS.SECONDARY
    self.tabContainer.BackgroundTransparency = 0.1
    self.tabContainer.BorderSizePixel = 0
    self.tabContainer.ScrollBarThickness = 3
    self.tabContainer.ScrollBarImageColor3 = COLORS.BORDER
    self.tabContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.tabContainer.Parent = self.contentFrame
    
    local tabCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    tabCorner.Parent = self.tabContainer
    
    local tabListLayout = Instance.new("UIListLayout")
    tabListLayout.Padding = UDim.new(0, SIZES.PADDING)
    tabListLayout.Parent = self.tabContainer
    
    local tabPadding = CreateUIPadding(SIZES.PADDING)
    tabPadding.Parent = self.tabContainer
    
    -- 右侧内容区域
    self.optionsContainer = Instance.new("ScrollingFrame")
    self.optionsContainer.Name = "OptionsContainer"
    self.optionsContainer.Size = UDim2.new(0.7, 0, 1, 0)
    self.optionsContainer.Position = UDim2.new(0.3, 0, 0, 0)
    self.optionsContainer.BackgroundTransparency = 1
    self.optionsContainer.ScrollBarThickness = 3
    self.optionsContainer.ScrollBarImageColor3 = COLORS.BORDER
    self.optionsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.optionsContainer.Parent = self.contentFrame
    
    local optionsListLayout = Instance.new("UIListLayout")
    optionsListLayout.Padding = UDim.new(0, SIZES.PADDING)
    optionsListLayout.Parent = self.optionsContainer
    
    local optionsPadding = CreateUIPadding(SIZES.PADDING)
    optionsPadding.Parent = self.optionsContainer
    
    -- 搜索栏
    self.searchContainer = Instance.new("Frame")
    self.searchContainer.Name = "SearchContainer"
    self.searchContainer.Size = UDim2.new(1, 0, 0, 50)
    self.searchContainer.BackgroundTransparency = 1
    self.searchContainer.Visible = false
    self.searchContainer.Parent = self.optionsContainer
    
    self.searchBox = Instance.new("TextBox")
    self.searchBox.Name = "SearchBox"
    self.searchBox.PlaceholderText = "搜索选项..."
    self.searchBox.Text = ""
    self.searchBox.Font = FONTS.BODY
    self.searchBox.TextSize = 14
    self.searchBox.TextColor3 = COLORS.TEXT
    self.searchBox.BackgroundColor3 = COLORS.SECONDARY
    self.searchBox.Size = UDim2.new(1, -20, 0, 35)
    self.searchBox.Position = UDim2.new(0, 10, 0, 10)
    self.searchBox.ClearTextOnFocus = false
    self.searchBox.Parent = self.searchContainer
    
    local searchCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    searchCorner.Parent = self.searchBox
    
    local searchPadding = Instance.new("UIPadding")
    searchPadding.PaddingLeft = UDim.new(0, 10)
    searchPadding.PaddingRight = UDim.new(0, 10)
    searchPadding.Parent = self.searchBox
    
    -- 初始化预设标签
    self:InitializeDefaultTabs()
    
    -- 添加到玩家界面
    if game:GetService("RunService"):IsClient() then
        self.screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
end

-- 设置拖动
function VapeUI:SetupDrag()
    if not self.config.draggable then return end
    
    local dragging = false
    local dragInput
    local dragStart
    local startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        self.mainContainer.Position = UDim2.new(
            startPos.X.Scale, 
            startPos.X.Offset + delta.X,
            startPos.Y.Scale, 
            startPos.Y.Offset + delta.Y
        )
    end
    
    self.titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = self.mainContainer.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    self.titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)
end

-- 设置事件监听
function VapeUI:SetupEvents()
    -- 关闭按钮事件
    self.closeButton.MouseButton1Click:Connect(function()
        self:Hide()
    end)
    
    -- 设置按钮事件
    self.settingsButton.MouseButton1Click:Connect(function()
        self:ShowSettings()
    end)
    
    -- 搜索框事件
    self.searchBox:GetPropertyChangedSignal("Text"):Connect(function()
        self:SearchOptions(self.searchBox.Text)
    end)
    
    -- 触摸优化
    if self.config.mobileOptimized then
        self:OptimizeForMobile()
    end
end

-- 移动端优化
function VapeUI:OptimizeForMobile()
    -- 增大触摸区域
    for _, button in pairs(self.mainContainer:GetDescendants()) do
        if button:IsA("TextButton") or button:IsA("ImageButton") then
            local touchArea = Instance.new("Frame")
            touchArea.Name = "TouchArea"
            touchArea.Size = UDim2.new(1, 10, 1, 10)
            touchArea.Position = UDim2.new(0, -5, 0, -5)
            touchArea.BackgroundTransparency = 1
            touchArea.Active = true
            touchArea.Parent = button
        end
    end
    
    -- 添加触摸反馈
    local function addTouchFeedback(button)
        local originalSize = button.Size
        local originalColor = button.BackgroundColor3 or Color3.new(1, 1, 1)
        
        button.MouseButton1Down:Connect(function()
            Tween(button, {Size = originalSize + UDim2.new(0, -2, 0, -2)}, 0.1)
            if button.BackgroundColor3 then
                Tween(button, {BackgroundColor3 = originalColor * 0.8}, 0.1)
            end
        end)
        
        button.MouseButton1Up:Connect(function()
            Tween(button, {Size = originalSize}, 0.1)
            if button.BackgroundColor3 then
                Tween(button, {BackgroundColor3 = originalColor}, 0.1)
            end
        end)
    end
    
    -- 为所有按钮添加触摸反馈
    for _, button in pairs(self.mainContainer:GetDescendants()) do
        if button:IsA("TextButton") or button:IsA("ImageButton") then
            addTouchFeedback(button)
        end
    end
end

-- 初始化默认标签
function VapeUI:InitializeDefaultTabs()
    -- 根据图片中的标签创建
    local defaultTabs = {
        {name = "Combat", color = COLORS.SUCCESS},
        {name = "Render", color = COLORS.ACCENT},
        {name = "Utility", color = COLORS.ACCENT},
        {name = "World", color = COLORS.ACCENT},
        {name = "Inventory", color = COLORS.ACCENT},
        {name = "Minigames", color = COLORS.ACCENT},
        {name = "Other", color = COLORS.ACCENT}
    }
    
    for _, tabInfo in ipairs(defaultTabs) do
        self:AddTab(tabInfo.name, tabInfo.color)
    end
    
    -- 添加底部项目
    self:AddBottomSection()
end

-- 添加底部部分
function VapeUI:AddBottomSection()
    local bottomSection = Instance.new("Frame")
    bottomSection.Name = "BottomSection"
    bottomSection.Size = UDim2.new(1, 0, 0, 100)
    bottomSection.BackgroundTransparency = 1
    bottomSection.Parent = self.tabContainer
    
    local bottomListLayout = Instance.new("UIListLayout")
    bottomListLayout.Padding = UDim.new(0, SIZES.PADDING)
    bottomListLayout.Parent = bottomSection
    
    -- Friends
    local friendsButton = Instance.new("TextButton")
    friendsButton.Name = "Friends"
    friendsButton.Text = "  Friends"
    friendsButton.Font = FONTS.BODY
    friendsButton.TextSize = 14
    friendsButton.TextColor3 = COLORS.SUBTEXT
    friendsButton.TextXAlignment = Enum.TextXAlignment.Left
    friendsButton.Size = UDim2.new(1, -10, 0, SIZES.TAB_HEIGHT)
    friendsButton.Position = UDim2.new(0, 5, 0, 0)
    friendsButton.BackgroundColor3 = COLORS.SECONDARY
    friendsButton.AutoButtonColor = false
    friendsButton.Parent = bottomSection
    
    -- Profiles
    local profilesButton = Instance.new("TextButton")
    profilesButton.Name = "Profiles"
    profilesButton.Text = "  Profiles"
    profilesButton.Font = FONTS.BODY
    profilesButton.TextSize = 14
    profilesButton.TextColor3 = COLORS.SUBTEXT
    profilesButton.TextXAlignment = Enum.TextXAlignment.Left
    profilesButton.Size = UDim2.new(1, -10, 0, SIZES.TAB_HEIGHT)
    profilesButton.Position = UDim2.new(0, 5, 0, 0)
    profilesButton.BackgroundColor3 = COLORS.SECONDARY
    profilesButton.AutoButtonColor = false
    profilesButton.Parent = bottomSection
    
    -- 下拉选择器
    local profileDropdown = Instance.new("TextButton")
    profileDropdown.Name = "ProfileDropdown"
    profileDropdown.Text = "default ▼"
    profileDropdown.Font = FONTS.BODY
    profileDropdown.TextSize = 12
    profileDropdown.TextColor3 = COLORS.SUBTEXT
    profileDropdown.Size = UDim2.new(0.5, 0, 0, 25)
    profileDropdown.Position = UDim2.new(0.5, 0, 0, 8)
    profileDropdown.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    profileDropdown.AutoButtonColor = false
    profileDropdown.Visible = false
    profileDropdown.Parent = profilesButton
    
    local profileCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    profileCorner.Parent = profileDropdown
    
    -- Macros
    local macrosButton = Instance.new("TextButton")
    macrosButton.Name = "Macros"
    macrosButton.Text = "  Macros"
    macrosButton.Font = FONTS.BODY
    macrosButton.TextSize = 14
    macrosButton.TextColor3 = COLORS.SUBTEXT
    macrosButton.TextXAlignment = Enum.TextXAlignment.Left
    macrosButton.Size = UDim2.new(1, -10, 0, SIZES.TAB_HEIGHT)
    macrosButton.Position = UDim2.new(0, 5, 0, 0)
    macrosButton.BackgroundColor3 = COLORS.SECONDARY
    macrosButton.AutoButtonColor = false
    macrosButton.Parent = bottomSection
    
    -- 按钮事件
    friendsButton.MouseButton1Click:Connect(function()
        self:ShowNotification("Friends功能开发中")
    end)
    
    profilesButton.MouseButton1Click:Connect(function()
        profileDropdown.Visible = not profileDropdown.Visible
    end)
    
    macrosButton.MouseButton1Click:Connect(function()
        self:ShowNotification("Macros功能开发中")
    end)
    
    profileDropdown.MouseButton1Click:Connect(function()
        self:ShowProfileDropdown()
    end)
    
    -- 悬停效果
    local function setupHover(button)
        button.MouseEnter:Connect(function()
            if button.Name ~= self.currentTab then
                button.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
            end
        end)
        
        button.MouseLeave:Connect(function()
            if button.Name ~= self.currentTab then
                button.BackgroundColor3 = COLORS.SECONDARY
            end
        end)
    end
    
    setupHover(friendsButton)
    setupHover(profilesButton)
    setupHover(macrosButton)
end

-- 添加标签
function VapeUI:AddTab(name, color)
    local tabButton = Instance.new("TextButton")
    tabButton.Name = name
    tabButton.Text = "  " .. name
    tabButton.Font = FONTS.BODY
    tabButton.TextSize = 14
    tabButton.TextColor3 = COLORS.SUBTEXT
    tabButton.TextXAlignment = Enum.TextXAlignment.Left
    tabButton.Size = UDim2.new(1, -10, 0, SIZES.TAB_HEIGHT)
    tabButton.Position = UDim2.new(0, 5, 0, 0)
    tabButton.BackgroundColor3 = COLORS.SECONDARY
    tabButton.AutoButtonColor = false
    tabButton.Parent = self.tabContainer
    
    local tabCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    tabCorner.Parent = tabButton
    
    -- 选中指示器
    local indicator = Instance.new("Frame")
    indicator.Name = "Indicator"
    indicator.Size = UDim2.new(0, 3, 0.7, 0)
    indicator.Position = UDim2.new(0, 2, 0.15, 0)
    indicator.BackgroundColor3 = color or COLORS.ACCENT
    indicator.BorderSizePixel = 0
    indicator.Visible = false
    indicator.Parent = tabButton
    
    local indicatorCorner = CreateUICorner(2)
    indicatorCorner.Parent = indicator
    
    -- 创建标签内容容器
    local tabContent = Instance.new("Frame")
    tabContent.Name = name .. "Content"
    tabContent.Size = UDim2.new(1, 0, 0, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Visible = false
    tabContent.Parent = self.optionsContainer
    
    local contentListLayout = Instance.new("UIListLayout")
    contentListLayout.Padding = UDim.new(0, SIZES.PADDING)
    contentListLayout.Parent = tabContent
    
    -- 悬停效果
    tabButton.MouseEnter:Connect(function()
        if self.currentTab ~= name then
            Tween(tabButton, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}, 0.2)
        end
    end)
    
    tabButton.MouseLeave:Connect(function()
        if self.currentTab ~= name then
            Tween(tabButton, {BackgroundColor3 = COLORS.SECONDARY}, 0.2)
        end
    end)
    
    -- 点击事件
    tabButton.MouseButton1Click:Connect(function()
        self:SwitchTab(name)
    end)
    
    -- 存储标签
    self.tabs[name] = {
        button = tabButton,
        content = tabContent,
        indicator = indicator,
        options = {}
    }
    
    -- 如果是第一个标签，设置为当前
    if not self.currentTab then
        self:SwitchTab(name)
    end
    
    return self.tabs[name]
end

-- 切换标签
function VapeUI:SwitchTab(tabName)
    if self.currentTab then
        local prevTab = self.tabs[self.currentTab]
        if prevTab then
            prevTab.content.Visible = false
            prevTab.indicator.Visible = false
            Tween(prevTab.button, {
                BackgroundColor3 = COLORS.SECONDARY,
                TextColor3 = COLORS.SUBTEXT
            }, 0.2)
        end
    end
    
    local tab = self.tabs[tabName]
    if tab then
        self.currentTab = tabName
        tab.content.Visible = true
        tab.indicator.Visible = true
        Tween(tab.button, {
            BackgroundColor3 = Color3.fromRGB(60, 60, 70),
            TextColor3 = COLORS.TEXT
        }, 0.2)
        
        -- 自动滚动到顶部
        self.optionsContainer.CanvasPosition = Vector2.new(0, 0)
    end
end

-- 添加选项
function VapeUI:AddOption(tabName, optionName, defaultValue, callback, settingsCallback)
    local tab = self.tabs[tabName]
    if not tab then return nil end
    
    local optionFrame = Instance.new("Frame")
    optionFrame.Name = optionName
    optionFrame.Size = UDim2.new(1, -20, 0, SIZES.OPTION_HEIGHT)
    optionFrame.Position = UDim2.new(0, 10, 0, 0)
    optionFrame.BackgroundColor3 = COLORS.SECONDARY
    optionFrame.BackgroundTransparency = 0.1
    optionFrame.BorderSizePixel = 0
    optionFrame.Parent = tab.content
    
    local optionCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    optionCorner.Parent = optionFrame
    
    -- 选项名称
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "Label"
    nameLabel.Text = "  " .. optionName
    nameLabel.Font = FONTS.BODY
    nameLabel.TextSize = 14
    nameLabel.TextColor3 = COLORS.TEXT
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Size = UDim2.new(0.7, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Parent = optionFrame
    
    -- 设置按钮（三点按钮）
    local settingsButton = Instance.new("TextButton")
    settingsButton.Name = "SettingsButton"
    settingsButton.Text = "..."
    settingsButton.Font = FONTS.BODY
    settingsButton.TextSize = 16
    settingsButton.TextColor3 = COLORS.SUBTEXT
    settingsButton.Size = UDim2.new(0, 30, 0, 30)
    settingsButton.Position = UDim2.new(1, -40, 0.5, -15)
    settingsButton.BackgroundTransparency = 1
    settingsButton.BorderSizePixel = 0
    settingsButton.Parent = optionFrame
    
    -- 开关控件
    local toggle = Instance.new("TextButton")
    toggle.Name = "Toggle"
    toggle.Text = ""
    toggle.Size = UDim2.new(0, 50, 0, 25)
    toggle.Position = UDim2.new(1, -100, 0.5, -12.5)
    toggle.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    toggle.BorderSizePixel = 0
    toggle.AutoButtonColor = false
    toggle.Parent = optionFrame
    
    local toggleCorner = CreateUICorner(12)
    toggleCorner.Parent = toggle
    
    local toggleIndicator = Instance.new("Frame")
    toggleIndicator.Name = "Indicator"
    toggleIndicator.Size = UDim2.new(0, 21, 1, -4)
    toggleIndicator.Position = UDim2.new(0, 2, 0, 2)
    toggleIndicator.BackgroundColor3 = Color3.fromRGB(100, 100, 110)
    toggleIndicator.BorderSizePixel = 0
    toggleIndicator.Parent = toggle
    
    local indicatorCorner = CreateUICorner(10)
    indicatorCorner.Parent = toggleIndicator
    
    -- 选项状态
    local optionData = {
        name = optionName,
        enabled = defaultValue or false,
        frame = optionFrame,
        toggle = toggle,
        indicator = toggleIndicator,
        callback = callback,
        settingsCallback = settingsCallback
    }
    
    -- 初始化状态
    self:UpdateToggleState(optionData)
    
    -- 开关点击事件
    toggle.MouseButton1Click:Connect(function()
        optionData.enabled = not optionData.enabled
        self:UpdateToggleState(optionData)
        
        if optionData.callback then
            optionData.callback(optionData.enabled)
        end
    end)
    
    -- 设置按钮事件
    settingsButton.MouseButton1Click:Connect(function()
        if optionData.settingsCallback then
            optionData.settingsCallback(optionData)
        else
            self:ShowOptionSettings(optionData)
        end
    end)
    
    -- 悬停效果
    optionFrame.MouseEnter:Connect(function()
        Tween(optionFrame, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}, 0.2)
    end)
    
    optionFrame.MouseLeave:Connect(function()
        Tween(optionFrame, {BackgroundColor3 = COLORS.SECONDARY}, 0.2)
    end)
    
    settingsButton.MouseEnter:Connect(function()
        Tween(settingsButton, {TextColor3 = COLORS.ACCENT}, 0.2)
    end)
    
    settingsButton.MouseLeave:Connect(function()
        Tween(settingsButton, {TextColor3 = COLORS.SUBTEXT}, 0.2)
    end)
    
    -- 存储选项
    table.insert(tab.options, optionData)
    self.options[optionName] = optionData
    
    return optionData
end

-- 更新开关状态
function VapeUI:UpdateToggleState(optionData)
    if optionData.enabled then
        Tween(optionData.toggle, {BackgroundColor3 = COLORS.ACCENT}, 0.2)
        Tween(optionData.indicator, {
            Position = UDim2.new(1, -23, 0, 2),
            BackgroundColor3 = Color3.new(1, 1, 1)
        }, 0.2)
    else
        Tween(optionData.toggle, {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}, 0.2)
        Tween(optionData.indicator, {
            Position = UDim2.new(0, 2, 0, 2),
            BackgroundColor3 = Color3.fromRGB(100, 100, 110)
        }, 0.2)
    end
end

-- 添加滑块
function VapeUI:AddSlider(tabName, optionName, min, max, defaultValue, callback)
    local tab = self.tabs[tabName]
    if not tab then return nil end
    
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Name = optionName
    sliderFrame.Size = UDim2.new(1, -20, 0, SIZES.OPTION_HEIGHT)
    sliderFrame.Position = UDim2.new(0, 10, 0, 0)
    sliderFrame.BackgroundColor3 = COLORS.SECONDARY
    sliderFrame.BackgroundTransparency = 0.1
    sliderFrame.BorderSizePixel = 0
    sliderFrame.Parent = tab.content
    
    local sliderCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    sliderCorner.Parent = sliderFrame
    
    -- 选项名称
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "Label"
    nameLabel.Text = "  " .. optionName
    nameLabel.Font = FONTS.BODY
    nameLabel.TextSize = 14
    nameLabel.TextColor3 = COLORS.TEXT
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Size = UDim2.new(0.6, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Parent = sliderFrame
    
    -- 值显示
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "ValueLabel"
    valueLabel.Text = tostring(defaultValue or min)
    valueLabel.Font = FONTS.BODY
    valueLabel.TextSize = 12
    valueLabel.TextColor3 = COLORS.SUBTEXT
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Size = UDim2.new(0.3, 0, 1, 0)
    valueLabel.Position = UDim2.new(0.7, 0, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Parent = sliderFrame
    
    -- 滑块轨道
    local track = Instance.new("Frame")
    track.Name = "Track"
    track.Size = UDim2.new(0.8, 0, 0, 4)
    track.Position = UDim2.new(0.1, 0, 0.8, 0)
    track.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    track.BorderSizePixel = 0
    track.Parent = sliderFrame
    
    local trackCorner = CreateUICorner(2)
    trackCorner.Parent = track
    
    -- 滑块进度
    local fill = Instance.new("Frame")
    fill.Name = "Fill"
    fill.Size = UDim2.new(0, 0, 1, 0)
    fill.BackgroundColor3 = COLORS.ACCENT
    fill.BorderSizePixel = 0
    fill.Parent = track
    
    local fillCorner = CreateUICorner(2)
    fillCorner.Parent = fill
    
    -- 滑块手柄
    local handle = Instance.new("Frame")
    handle.Name = "Handle"
    handle.Size = UDim2.new(0, 12, 0, 12)
    handle.Position = UDim2.new(0, -6, 0.5, -6)
    handle.BackgroundColor3 = Color3.new(1, 1, 1)
    handle.BorderSizePixel = 0
    handle.Parent = track
    
    local handleCorner = CreateUICorner(6)
    handleCorner.Parent = handle
    
    -- 滑块数据
    local sliderData = {
        name = optionName,
        min = min or 0,
        max = max or 100,
        value = defaultValue or min,
        frame = sliderFrame,
        track = track,
        fill = fill,
        handle = handle,
        valueLabel = valueLabel,
        callback = callback
    }
    
    -- 初始化滑块
    self:UpdateSliderValue(sliderData)
    
    -- 滑块交互
    local dragging = false
    
    local function updateSlider(input)
        local relativeX = (input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X
        local value = math.clamp(relativeX * (max - min) + min, min, max)
        
        sliderData.value = value
        self:UpdateSliderValue(sliderData)
        
        if sliderData.callback then
            sliderData.callback(value)
        end
    end
    
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
        end
    end)
    
    handle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            updateSlider(input)
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or 
           input.UserInputType == Enum.UserInputType.Touch) then
            updateSlider(input)
        end
    end)
    
    -- 悬停效果
    sliderFrame.MouseEnter:Connect(function()
        Tween(sliderFrame, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}, 0.2)
    end)
    
    sliderFrame.MouseLeave:Connect(function()
        Tween(sliderFrame, {BackgroundColor3 = COLORS.SECONDARY}, 0.2)
    end)
    
    handle.MouseEnter:Connect(function()
        Tween(handle, {Size = UDim2.new(0, 16, 0, 16)}, 0.2)
    end)
    
    handle.MouseLeave:Connect(function()
        if not dragging then
            Tween(handle, {Size = UDim2.new(0, 12, 0, 12)}, 0.2)
        end
    end)
    
    -- 存储滑块
    table.insert(tab.options, sliderData)
    
    return sliderData
end

-- 更新滑块值
function VapeUI:UpdateSliderValue(sliderData)
    local percentage = (sliderData.value - sliderData.min) / (sliderData.max - sliderData.min)
    sliderData.fill.Size = UDim2.new(percentage, 0, 1, 0)
    sliderData.handle.Position = UDim2.new(percentage, -6, 0.5, -6)
    sliderData.valueLabel.Text = string.format("%.1f", sliderData.value)
end

-- 添加颜色选择器
function VapeUI:AddColorPicker(tabName, optionName, defaultColor, callback)
    local tab = self.tabs[tabName]
    if not tab then return nil end
    
    local colorFrame = Instance.new("Frame")
    colorFrame.Name = optionName
    colorFrame.Size = UDim2.new(1, -20, 0, SIZES.OPTION_HEIGHT)
    colorFrame.Position = UDim2.new(0, 10, 0, 0)
    colorFrame.BackgroundColor3 = COLORS.SECONDARY
    colorFrame.BackgroundTransparency = 0.1
    colorFrame.BorderSizePixel = 0
    colorFrame.Parent = tab.content
    
    local colorCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    colorCorner.Parent = colorFrame
    
    -- 选项名称
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "Label"
    nameLabel.Text = "  " .. optionName
    nameLabel.Font = FONTS.BODY
    nameLabel.TextSize = 14
    nameLabel.TextColor3 = COLORS.TEXT
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Size = UDim2.new(0.7, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Parent = colorFrame
    
    -- 颜色预览
    local colorPreview = Instance.new("Frame")
    colorPreview.Name = "ColorPreview"
    colorPreview.Size = UDim2.new(0, 60, 0, 25)
    colorPreview.Position = UDim2.new(1, -70, 0.5, -12.5)
    colorPreview.BackgroundColor3 = defaultColor or Color3.new(1, 1, 1)
    colorPreview.BorderSizePixel = 0
    colorPreview.Parent = colorFrame
    
    local previewCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    previewCorner.Parent = colorPreview
    
    local previewStroke = CreateUIStroke(2, Color3.new(0, 0, 0))
    previewStroke.Parent = colorPreview
    
    -- 颜色选择器数据
    local colorData = {
        name = optionName,
        color = defaultColor or Color3.new(1, 1, 1),
        frame = colorFrame,
        preview = colorPreview,
        callback = callback
    }
    
    -- 颜色选择器弹出窗口
    local colorPickerWindow = Instance.new("Frame")
    colorPickerWindow.Name = "ColorPickerWindow"
    colorPickerWindow.Size = UDim2.new(0, 200, 0, 250)
    colorPickerWindow.Position = UDim2.new(0.5, -100, 0.5, -125)
    colorPickerWindow.BackgroundColor3 = COLORS.BACKGROUND
    colorPickerWindow.BackgroundTransparency = 0.1
    colorPickerWindow.BorderSizePixel = 0
    colorPickerWindow.Visible = false
    colorPickerWindow.ZIndex = 100
    colorPickerWindow.Parent = self.mainContainer
    
    local windowCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    windowCorner.Parent = colorPickerWindow
    
    local windowStroke = CreateUIStroke(2, COLORS.BORDER)
    windowStroke.Parent = colorPickerWindow
    
    -- 颜色选择器内容
    local colorWheel = Instance.new("ImageLabel")
    colorWheel.Name = "ColorWheel"
    colorWheel.Size = UDim2.new(0, 150, 0, 150)
    colorWheel.Position = UDim2.new(0.5, -75, 0, 10)
    colorWheel.Image = "rbxassetid://2670297347" -- 颜色轮图片
    colorWheel.BackgroundTransparency = 1
    colorWheel.Parent = colorPickerWindow
    
    -- 亮度滑块
    local brightnessSlider = Instance.new("Frame")
    brightnessSlider.Name = "BrightnessSlider"
    brightnessSlider.Size = UDim2.new(0, 20, 0, 150)
    brightnessSlider.Position = UDim2.new(1, -30, 0, 10)
    brightnessSlider.BackgroundColor3 = Color3.new(1, 1, 1)
    brightnessSlider.BorderSizePixel = 0
    brightnessSlider.Parent = colorPickerWindow
    
    local brightnessGradient = Instance.new("UIGradient")
    brightnessGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.new(0, 0, 0)),
        ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
    })
    brightnessGradient.Rotation = 90
    brightnessGradient.Parent = brightnessSlider
    
    -- 确认按钮
    local confirmButton = Instance.new("TextButton")
    confirmButton.Name = "ConfirmButton"
    confirmButton.Text = "确定"
    confirmButton.Font = FONTS.BODY
    confirmButton.TextSize = 14
    confirmButton.TextColor3 = COLORS.TEXT
    confirmButton.Size = UDim2.new(0, 80, 0, 30)
    confirmButton.Position = UDim2.new(0.5, -90, 1, -40)
    confirmButton.BackgroundColor3 = COLORS.ACCENT
    confirmButton.Parent = colorPickerWindow
    
    local confirmCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    confirmCorner.Parent = confirmButton
    
    -- 取消按钮
    local cancelButton = Instance.new("TextButton")
    cancelButton.Name = "CancelButton"
    cancelButton.Text = "取消"
    cancelButton.Font = FONTS.BODY
    cancelButton.TextSize = 14
    cancelButton.TextColor3 = COLORS.TEXT
    cancelButton.Size = UDim2.new(0, 80, 0, 30)
    cancelButton.Position = UDim2.new(0.5, 10, 1, -40)
    cancelButton.BackgroundColor3 = Color3.fromRGB(100, 100, 110)
    cancelButton.Parent = colorPickerWindow
    
    local cancelCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    cancelCorner.Parent = cancelButton
    
    -- 颜色预览框
    local selectedColorPreview = Instance.new("Frame")
    selectedColorPreview.Name = "SelectedColorPreview"
    selectedColorPreview.Size = UDim2.new(0, 50, 0, 30)
    selectedColorPreview.Position = UDim2.new(0, 10, 1, -40)
    selectedColorPreview.BackgroundColor3 = defaultColor or Color3.new(1, 1, 1)
    selectedColorPreview.BorderSizePixel = 0
    selectedColorPreview.Parent = colorPickerWindow
    
    local selectedCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    selectedCorner.Parent = selectedColorPreview
    
    -- 颜色选择逻辑
    local function selectColor(position)
        -- 这里应该实现颜色选择逻辑
        -- 由于Roblox的限制，这只是一个示例
        colorData.color = Color3.new(math.random(), math.random(), math.random())
        selectedColorPreview.BackgroundColor3 = colorData.color
    end
    
    -- 打开颜色选择器
    colorPreview.MouseButton1Click:Connect(function()
        colorPickerWindow.Visible = true
    end)
    
    -- 颜色轮点击
    colorWheel.MouseButton1Down:Connect(function(x, y)
        selectColor(Vector2.new(x, y))
    end)
    
    -- 确认按钮
    confirmButton.MouseButton1Click:Connect(function()
        colorPreview.BackgroundColor3 = colorData.color
        colorPickerWindow.Visible = false
        
        if colorData.callback then
            colorData.callback(colorData.color)
        end
    end)
    
    -- 取消按钮
    cancelButton.MouseButton1Click:Connect(function()
        colorPickerWindow.Visible = false
    end)
    
    -- 悬停效果
    colorFrame.MouseEnter:Connect(function()
        Tween(colorFrame, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}, 0.2)
    end)
    
    colorFrame.MouseLeave:Connect(function()
        Tween(colorFrame, {BackgroundColor3 = COLORS.SECONDARY}, 0.2)
    end)
    
    colorPreview.MouseEnter:Connect(function()
        Tween(colorPreview, {Size = UDim2.new(0, 65, 0, 30)}, 0.2)
    end)
    
    colorPreview.MouseLeave:Connect(function()
        Tween(colorPreview, {Size = UDim2.new(0, 60, 0, 25)}, 0.2)
    end)
    
    -- 存储颜色选择器
    table.insert(tab.options, colorData)
    
    return colorData
end

-- 搜索选项
function VapeUI:SearchOptions(query)
    if query == "" then
        -- 显示所有选项
        for tabName, tab in pairs(self.tabs) do
            for _, option in ipairs(tab.options) do
                if option.frame then
                    option.frame.Visible = true
                end
            end
        end
        self.searchContainer.Visible = false
        return
    end
    
    query = query:lower()
    local foundAny = false
    
    for tabName, tab in pairs(self.tabs) do
        for _, option in ipairs(tab.options) do
            if option.frame and option.name:lower():find(query) then
                option.frame.Visible = true
                foundAny = true
                
                -- 高亮匹配文本
                if option.frame:FindFirstChild("Label") then
                    local label = option.frame.Label
                    local text = option.name
                    local startPos, endPos = text:lower():find(query)
                    
                    if startPos then
                        label.Text = "  " .. text:sub(1, startPos-1) .. 
                                   "<font color='rgb(0,162,255)'>" .. 
                                   text:sub(startPos, endPos) .. 
                                   "</font>" .. 
                                   text:sub(endPos+1)
                    end
                end
            elseif option.frame then
                option.frame.Visible = false
            end
        end
    end
    
    self.searchContainer.Visible = foundAny
end

-- 显示选项设置
function VapeUI:ShowOptionSettings(optionData)
    local settingsWindow = Instance.new("Frame")
    settingsWindow.Name = "SettingsWindow"
    settingsWindow.Size = UDim2.new(0, 300, 0, 200)
    settingsWindow.Position = UDim2.new(0.5, -150, 0.5, -100)
    settingsWindow.BackgroundColor3 = COLORS.BACKGROUND
    settingsWindow.BackgroundTransparency = 0.1
    settingsWindow.BorderSizePixel = 0
    settingsWindow.ZIndex = 100
    settingsWindow.Parent = self.mainContainer
    
    local windowCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    windowCorner.Parent = settingsWindow
    
    local windowStroke = CreateUIStroke(2, COLORS.BORDER)
    windowStroke.Parent = settingsWindow
    
    -- 标题栏
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = COLORS.SECONDARY
    titleBar.BorderSizePixel = 0
    titleBar.Parent = settingsWindow
    
    local titleCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    titleCorner.CornerRadius = UDim.new(0, SIZES.BORDER_RADIUS * 2)
    titleCorner.Parent = titleBar
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Text = optionData.name .. " 设置"
    titleLabel.Font = FONTS.BODY
    titleLabel.TextSize = 14
    titleLabel.TextColor3 = COLORS.TEXT
    titleLabel.Size = UDim2.new(1, -40, 1, 0)
    titleLabel.Position = UDim2.new(0, 10, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar
    
    local closeButton = Instance.new("TextButton")
    closeButton.Text = "×"
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 18
    closeButton.TextColor3 = COLORS.SUBTEXT
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.BackgroundTransparency = 1
    closeButton.Parent = titleBar
    
    -- 内容区域
    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 3
    contentFrame.ScrollBarImageColor3 = COLORS.BORDER
    contentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    contentFrame.Parent = settingsWindow
    
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, SIZES.PADDING)
    contentLayout.Parent = contentFrame
    
    local contentPadding = CreateUIPadding(SIZES.PADDING)
    contentPadding.Parent = contentFrame
    
    -- 关闭按钮事件
    closeButton.MouseButton1Click:Connect(function()
        settingsWindow:Destroy()
    end)
    
    -- 点击外部关闭
    local backgroundOverlay = Instance.new("TextButton")
    backgroundOverlay.Size = UDim2.new(1, 0, 1, 0)
    backgroundOverlay.BackgroundTransparency = 1
    backgroundOverlay.Text = ""
    backgroundOverlay.ZIndex = 99
    backgroundOverlay.Parent = self.mainContainer
    
    backgroundOverlay.MouseButton1Click:Connect(function()
        settingsWindow:Destroy()
        backgroundOverlay:Destroy()
    end)
    
    -- 添加一些示例设置
    self:AddSettingOption(contentFrame, "启用音效", "Toggle", true)
    self:AddSettingOption(contentFrame, "灵敏度", "Slider", 50, 0, 100)
    self:AddSettingOption(contentFrame, "颜色主题", "Dropdown", {"深色", "浅色", "自动"})
    
    return settingsWindow
end

-- 添加设置选项
function VapeUI:AddSettingOption(parent, name, type, defaultValue, min, max, options)
    local settingFrame = Instance.new("Frame")
    settingFrame.Size = UDim2.new(1, 0, 0, SIZES.SETTING_HEIGHT)
    settingFrame.BackgroundTransparency = 1
    settingFrame.Parent = parent
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Text = name
    nameLabel.Font = FONTS.BODY
    nameLabel.TextSize = 12
    nameLabel.TextColor3 = COLORS.TEXT
    nameLabel.Size = UDim2.new(0.6, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = settingFrame
    
    if type == "Toggle" then
        local toggle = Instance.new("TextButton")
        toggle.Text = ""
        toggle.Size = UDim2.new(0, 40, 0, 20)
        toggle.Position = UDim2.new(1, -40, 0.5, -10)
        toggle.BackgroundColor3 = defaultValue and COLORS.ACCENT or Color3.fromRGB(60, 60, 70)
        toggle.BorderSizePixel = 0
        toggle.AutoButtonColor = false
        toggle.Parent = settingFrame
        
        local toggleCorner = CreateUICorner(10)
        toggleCorner.Parent = toggle
        
        local indicator = Instance.new("Frame")
        indicator.Size = UDim2.new(0, 16, 1, -4)
        indicator.Position = defaultValue and UDim2.new(1, -18, 0, 2) or UDim2.new(0, 2, 0, 2)
        indicator.BackgroundColor3 = Color3.new(1, 1, 1)
        indicator.BorderSizePixel = 0
        indicator.Parent = toggle
        
        local indicatorCorner = CreateUICorner(8)
        indicatorCorner.Parent = indicator
        
        toggle.MouseButton1Click:Connect(function()
            defaultValue = not defaultValue
            toggle.BackgroundColor3 = defaultValue and COLORS.ACCENT or Color3.fromRGB(60, 60, 70)
            Tween(indicator, {
                Position = defaultValue and UDim2.new(1, -18, 0, 2) or UDim2.new(0, 2, 0, 2)
            }, 0.2)
        end)
        
    elseif type == "Slider" then
        local valueLabel = Instance.new("TextLabel")
        valueLabel.Text = tostring(defaultValue)
        valueLabel.Font = FONTS.BODY
        valueLabel.TextSize = 12
        valueLabel.TextColor3 = COLORS.SUBTEXT
        valueLabel.Size = UDim2.new(0.3, 0, 1, 0)
        valueLabel.Position = UDim2.new(0.7, 0, 0, 0)
        valueLabel.BackgroundTransparency = 1
        valueLabel.TextXAlignment = Enum.TextXAlignment.Right
        valueLabel.Parent = settingFrame
        
    elseif type == "Dropdown" then
        local dropdown = Instance.new("TextButton")
        dropdown.Text = defaultValue or "选择..."
        dropdown.Font = FONTS.BODY
        dropdown.TextSize = 12
        dropdown.TextColor3 = COLORS.TEXT
        dropdown.Size = UDim2.new(0, 100, 0, 25)
        dropdown.Position = UDim2.new(1, -100, 0.5, -12.5)
        dropdown.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        dropdown.AutoButtonColor = false
        dropdown.Parent = settingFrame
        
        local dropdownCorner = CreateUICorner(SIZES.BORDER_RADIUS)
        dropdownCorner.Parent = dropdown
        
        dropdown.MouseButton1Click:Connect(function()
            self:ShowDropdown(dropdown, options or {})
        end)
    end
    
    return settingFrame
end

-- 显示下拉菜单
function VapeUI:ShowDropdown(button, options)
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0, button.AbsoluteSize.X, 0, #options * 25)
    dropdownFrame.Position = UDim2.new(0, 0, 1, 0)
    dropdownFrame.BackgroundColor3 = COLORS.BACKGROUND
    dropdownFrame.BorderSizePixel = 0
    dropdownFrame.ZIndex = 1000
    dropdownFrame.Parent = button
    
    local dropdownCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    dropdownCorner.Parent = dropdownFrame
    
    local dropdownStroke = CreateUIStroke(1, COLORS.BORDER)
    dropdownStroke.Parent = dropdownFrame
    
    for i, option in ipairs(options) do
        local optionButton = Instance.new("TextButton")
        optionButton.Text = option
        optionButton.Font = FONTS.BODY
        optionButton.TextSize = 12
        optionButton.TextColor3 = COLORS.TEXT
        optionButton.Size = UDim2.new(1, 0, 0, 25)
        optionButton.Position = UDim2.new(0, 0, 0, (i-1)*25)
        optionButton.BackgroundColor3 = COLORS.SECONDARY
        optionButton.BorderSizePixel = 0
        optionButton.AutoButtonColor = false
        optionButton.ZIndex = 1001
        optionButton.Parent = dropdownFrame
        
        optionButton.MouseEnter:Connect(function()
            optionButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
        end)
        
        optionButton.MouseLeave:Connect(function()
            optionButton.BackgroundColor3 = COLORS.SECONDARY
        end)
        
        optionButton.MouseButton1Click:Connect(function()
            button.Text = option
            dropdownFrame:Destroy()
        end)
    end
    
    -- 点击外部关闭
    local function closeDropdown()
        if dropdownFrame and dropdownFrame.Parent then
            dropdownFrame:Destroy()
        end
    end
    
    game:GetService("UserInputService").InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local mousePos = input.Position
            local absolutePos = dropdownFrame.AbsolutePosition
            local absoluteSize = dropdownFrame.AbsoluteSize
            
            if mousePos.X < absolutePos.X or mousePos.X > absolutePos.X + absoluteSize.X or
               mousePos.Y < absolutePos.Y or mousePos.Y > absolutePos.Y + absoluteSize.Y then
                closeDropdown()
            end
        end
    end)
end

-- 显示配置文件下拉菜单
function VapeUI:ShowProfileDropdown()
    local profiles = {"default", "config1", "config2", "config3"}
    
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0, 150, 0, #profiles * 30)
    dropdownFrame.Position = UDim2.new(0.5, -75, 0.5, -#profiles * 15)
    dropdownFrame.BackgroundColor3 = COLORS.BACKGROUND
    dropdownFrame.BackgroundTransparency = 0.1
    dropdownFrame.BorderSizePixel = 0
    dropdownFrame.ZIndex = 1000
    dropdownFrame.Parent = self.mainContainer
    
    local dropdownCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    dropdownCorner.Parent = dropdownFrame
    
    local dropdownStroke = CreateUIStroke(2, COLORS.BORDER)
    dropdownStroke.Parent = dropdownFrame
    
    for i, profile in ipairs(profiles) do
        local profileButton = Instance.new("TextButton")
        profileButton.Text = profile
        profileButton.Font = FONTS.BODY
        profileButton.TextSize = 14
        profileButton.TextColor3 = COLORS.TEXT
        profileButton.Size = UDim2.new(1, -20, 0, 25)
        profileButton.Position = UDim2.new(0, 10, 0, 5 + (i-1)*30)
        profileButton.BackgroundColor3 = COLORS.SECONDARY
        profileButton.BorderSizePixel = 0
        profileButton.AutoButtonColor = false
        profileButton.ZIndex = 1001
        profileButton.Parent = dropdownFrame
        
        local buttonCorner = CreateUICorner(SIZES.BORDER_RADIUS)
        buttonCorner.Parent = profileButton
        
        profileButton.MouseEnter:Connect(function()
            Tween(profileButton, {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}, 0.2)
        end)
        
        profileButton.MouseLeave:Connect(function()
            Tween(profileButton, {BackgroundColor3 = COLORS.SECONDARY}, 0.2)
        end)
        
        profileButton.MouseButton1Click:Connect(function()
            self:SwitchProfile(profile)
            dropdownFrame:Destroy()
        end)
    end
    
    -- 点击外部关闭
    local backgroundOverlay = Instance.new("TextButton")
    backgroundOverlay.Size = UDim2.new(1, 0, 1, 0)
    backgroundOverlay.BackgroundTransparency = 1
    backgroundOverlay.Text = ""
    backgroundOverlay.ZIndex = 999
    backgroundOverlay.Parent = self.mainContainer
    
    backgroundOverlay.MouseButton1Click:Connect(function()
        dropdownFrame:Destroy()
        backgroundOverlay:Destroy()
    end)
end

-- 切换配置文件
function VapeUI:SwitchProfile(profileName)
    self:ShowNotification("切换到配置: " .. profileName)
    -- 这里可以添加加载配置的逻辑
end

-- 显示设置界面
function VapeUI:ShowSettings()
    local settingsWindow = Instance.new("Frame")
    settingsWindow.Name = "SettingsWindow"
    settingsWindow.Size = UDim2.new(0, 350, 0, 400)
    settingsWindow.Position = UDim2.new(0.5, -175, 0.5, -200)
    settingsWindow.BackgroundColor3 = COLORS.BACKGROUND
    settingsWindow.BackgroundTransparency = 0.1
    settingsWindow.BorderSizePixel = 0
    settingsWindow.ZIndex = 100
    settingsWindow.Parent = self.mainContainer
    
    local windowCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    windowCorner.Parent = settingsWindow
    
    local windowStroke = CreateUIStroke(2, COLORS.BORDER)
    windowStroke.Parent = settingsWindow
    
    -- 标题栏
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 40)
    titleBar.BackgroundColor3 = COLORS.SECONDARY
    titleBar.BorderSizePixel = 0
    titleBar.Parent = settingsWindow
    
    local titleCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    titleCorner.CornerRadius = UDim.new(0, SIZES.BORDER_RADIUS * 2)
    titleCorner.Parent = titleBar
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Text = "设置"
    titleLabel.Font = FONTS.BODY
    titleLabel.TextSize = 16
    titleLabel.TextColor3 = COLORS.TEXT
    titleLabel.Size = UDim2.new(1, -40, 1, 0)
    titleLabel.Position = UDim2.new(0, 10, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar
    
    local closeButton = Instance.new("TextButton")
    closeButton.Text = "×"
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 20
    closeButton.TextColor3 = COLORS.SUBTEXT
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -30, 0.5, -15)
    closeButton.BackgroundTransparency = 1
    closeButton.Parent = titleBar
    
    -- 内容区域
    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Size = UDim2.new(1, 0, 1, -40)
    contentFrame.Position = UDim2.new(0, 0, 0, 40)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 3
    contentFrame.ScrollBarImageColor3 = COLORS.BORDER
    contentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    contentFrame.Parent = settingsWindow
    
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, SIZES.PADDING)
    contentLayout.Parent = contentFrame
    
    local contentPadding = CreateUIPadding(SIZES.PADDING)
    contentPadding.Parent = contentFrame
    
    -- 添加设置选项
    self:AddSettingSection(contentFrame, "界面设置", {
        {name = "主题", type = "Dropdown", value = "深色", options = {"深色", "浅色", "自动"}},
        {name = "语言", type = "Dropdown", value = "简体中文", options = {"简体中文", "English", "Español"}},
        {name = "动画效果", type = "Toggle", value = true},
        {name = "显示通知", type = "Toggle", value = true}
    })
    
    self:AddSettingSection(contentFrame, "游戏设置", {
        {name = "帧率限制", type = "Slider", value = 60, min = 30, max = 144},
        {name = "渲染距离", type = "Slider", value = 100, min = 50, max = 500},
        {name = "图形质量", type = "Dropdown", value = "中", options = {"低", "中", "高", "超高"}}
    })
    
    self:AddSettingSection(contentFrame, "控制设置", {
        {name = "鼠标灵敏度", type = "Slider", value = 0.5, min = 0.1, max = 2},
        {name = "按键绑定", type = "Button", value = "配置"},
        {name = "触摸优化", type = "Toggle", value = true}
    })
    
    -- 关闭按钮事件
    closeButton.MouseButton1Click:Connect(function()
        settingsWindow:Destroy()
    end)
    
    -- 点击外部关闭
    local backgroundOverlay = Instance.new("TextButton")
    backgroundOverlay.Size = UDim2.new(1, 0, 1, 0)
    backgroundOverlay.BackgroundTransparency = 1
    backgroundOverlay.Text = ""
    backgroundOverlay.ZIndex = 99
    backgroundOverlay.Parent = self.mainContainer
    
    backgroundOverlay.MouseButton1Click:Connect(function()
        settingsWindow:Destroy()
        backgroundOverlay:Destroy()
    end)
end

-- 添加设置部分
function VapeUI:AddSettingSection(parent, title, settings)
    local sectionFrame = Instance.new("Frame")
    sectionFrame.Size = UDim2.new(1, 0, 0, 30 + #settings * 35)
    sectionFrame.BackgroundColor3 = COLORS.SECONDARY
    sectionFrame.BackgroundTransparency = 0.1
    sectionFrame.BorderSizePixel = 0
    sectionFrame.Parent = parent
    
    local sectionCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    sectionCorner.Parent = sectionFrame
    
    -- 部分标题
    local sectionTitle = Instance.new("TextLabel")
    sectionTitle.Text = title
    sectionTitle.Font = FONTS.HEADER
    sectionTitle.TextSize = 14
    sectionTitle.TextColor3 = COLORS.ACCENT
    sectionTitle.Size = UDim2.new(1, -20, 0, 30)
    sectionTitle.Position = UDim2.new(0, 10, 0, 0)
    sectionTitle.BackgroundTransparency = 1
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    sectionTitle.Parent = sectionFrame
    
    -- 添加设置项
    for i, setting in ipairs(settings) do
        local settingFrame = self:AddSettingOption(sectionFrame, setting.name, setting.type, setting.value, setting.min, setting.max, setting.options)
        settingFrame.Position = UDim2.new(0, 0, 0, 30 + (i-1)*35)
    end
end

-- 显示通知
function VapeUI:ShowNotification(message, duration)
    duration = duration or 3
    
    local notification = Instance.new("Frame")
    notification.Size = UDim2.new(0.8, 0, 0, 50)
    notification.Position = UDim2.new(0.1, 0, 0.1, 0)
    notification.BackgroundColor3 = COLORS.SECONDARY
    notification.BackgroundTransparency = 0.2
    notification.BorderSizePixel = 0
    notification.ZIndex = 1000
    notification.Parent = self.mainContainer
    
    local notificationCorner = CreateUICorner(SIZES.BORDER_RADIUS)
    notificationCorner.Parent = notification
    
    local notificationStroke = CreateUIStroke(1, COLORS.ACCENT)
    notificationStroke.Parent = notification
    
-- 使用方法示例
local VapeUI = require(script.Parent.VapeUI)

-- 创建UI实例
local ui = VapeUI.new({
    title = "VAPE",
    version = "4.0",
    position = UDim2.new(0.5, -150, 0.5, -200),
    size = UDim2.new(0, 300, 0, 400),
    mobileOptimized = true,
    draggable = true
})

-- 初始化并显示UI
ui:Create()

-- 添加自定义选项
ui:AddOption("Combat", "KillAura", false, function(enabled)
    if enabled then
        print("KillAura enabled")
        -- 激活KillAura逻辑
    else
        print("KillAura disabled")
        -- 停用KillAura逻辑
    end
end)

-- 添加自定义滑块
ui:AddSlider("Render", "FOV", 30, 120, 90, function(value)
    print("FOV set to:", value)
    -- 更新游戏FOV
end)

-- 添加颜色选择器
ui:AddColorPicker("Render", "ESP Color", Color3.new(1, 0, 0), function(color)
    print("ESP color changed to:", color)
    -- 更新ESP颜色
end)

-- 手动切换标签
ui:SwitchTab("Render")

-- 绑定自定义热键
game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
    if not processed then
        if input.KeyCode == Enum.KeyCode.RightControl then
            ui:Toggle()
        elseif input.KeyCode == Enum.KeyCode.Insert then
            ui:ShowNotification("快速通知测试", 2)
        end
    end
end)

-- 保存设置到数据存储
local function saveSettings()
    local settings = ui:SaveSettings()
    
    -- 使用DataStore2或其他数据存储方式
    local DataStore2 = require(game:GetService("ServerStorage"):WaitForChild("DataStore2"))
    DataStore2("VapeUISettings", game.Players.LocalPlayer):Set(settings)
end

-- 从数据存储加载设置
local function loadSettings()
    local DataStore2 = require(game:GetService("ServerStorage"):WaitForChild("DataStore2"))
    local settings = DataStore2("VapeUISettings", game.Players.LocalPlayer):Get(nil)
    
    if settings then
        ui:LoadSettings(settings)
    end
end

-- 游戏关闭时自动保存
game:GetService("Players").LocalPlayer.CharacterRemoving:Connect(function()
    saveSettings()
end)

-- 初始化时加载设置
loadSettings()

-- 返回UI实例以便其他脚本使用
return ui
