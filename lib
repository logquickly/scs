--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘              ğŸŒ™ VAPE V4 STYLE UI LIBRARY                      â•‘
    â•‘                   Version: 2.0.0                               â•‘
    â•‘              Author: Elite Roblox Developer                    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    ç‰¹æ€§:
    â€¢ å®Œå…¨æ¨¡ä»¿ Vape V4 é£æ ¼
    â€¢ OOP æ¶æ„ + å…ƒè¡¨
    â€¢ å¹³æ»‘åŠ¨ç”»ç³»ç»Ÿ
    â€¢ å³é”®å±•å¼€è®¾ç½®é¢æ¿
    â€¢ CoreGui ä¿æŠ¤
]]

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- æœåŠ¡å¼•ç”¨
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- é…ç½®å¸¸é‡
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CONFIG = {
    -- ä¸»é¢˜é¢œè‰²
    Theme = {
        Background = Color3.fromRGB(18, 18, 18),
        Secondary = Color3.fromRGB(25, 25, 25),
        Tertiary = Color3.fromRGB(35, 35, 35),
        Accent = Color3.fromRGB(85, 170, 127),
        AccentDark = Color3.fromRGB(65, 130, 97),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(180, 180, 180),
        Enabled = Color3.fromRGB(85, 170, 127),
        Disabled = Color3.fromRGB(255, 85, 85),
        Hover = Color3.fromRGB(45, 45, 45),
    },
    
    -- åŠ¨ç”»é…ç½®
    Animation = {
        Fast = TweenInfo.new(0.15, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        Medium = TweenInfo.new(0.25, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        Slow = TweenInfo.new(0.35, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        Smooth = TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
    },
    
    -- å°ºå¯¸é…ç½®
    Sizes = {
        WindowWidth = 580,
        WindowHeight = 420,
        SidebarWidth = 55,
        ModuleHeight = 38,
        CornerRadius = 8,
        SmallCorner = 6,
    },
    
    -- ZIndex å±‚çº§
    ZIndex = {
        Window = 100,
        Content = 110,
        Settings = 120,
        Dropdown = 200,
        Notification = 300,
        HUD = 50,
    },
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- å·¥å…·å‡½æ•°æ¨¡å—
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local Utility = {}

-- åˆ›å»ºå®ä¾‹
function Utility.Create(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties or {}) do
        if property ~= "Parent" then
            instance[property] = value
        end
    end
    if properties and properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

-- æ·»åŠ åœ†è§’
function Utility.AddCorner(parent, radius)
    return Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, radius or CONFIG.Sizes.CornerRadius),
        Parent = parent
    })
end

-- æ·»åŠ æè¾¹
function Utility.AddStroke(parent, color, thickness)
    return Utility.Create("UIStroke", {
        Color = color or CONFIG.Theme.Tertiary,
        Thickness = thickness or 1,
        Parent = parent
    })
end

-- æ·»åŠ é˜´å½±
function Utility.AddShadow(parent)
    local shadow = Utility.Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 24, 1, 24),
        ZIndex = parent.ZIndex - 1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450),
        Parent = parent
    })
    return shadow
end

-- å¹³æ»‘Tween
function Utility.Tween(instance, info, properties)
    local tween = TweenService:Create(instance, info, properties)
    tween:Play()
    return tween
end

-- æ¶Ÿæ¼ªæ•ˆæœ
function Utility.Ripple(button, x, y)
    local ripple = Utility.Create("Frame", {
        Name = "Ripple",
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.85,
        Position = UDim2.new(0, x - button.AbsolutePosition.X, 0, y - button.AbsolutePosition.Y),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = button.ZIndex + 1,
        Parent = button
    })
    Utility.AddCorner(ripple, 100)
    
    local size = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 2
    Utility.Tween(ripple, CONFIG.Animation.Medium, {
        Size = UDim2.new(0, size, 0, size),
        BackgroundTransparency = 1
    }).Completed:Connect(function()
        ripple:Destroy()
    end)
end

-- å®‰å…¨è·å–GUIçˆ¶çº§
function Utility.GetGuiParent()
    if gethui then
        return gethui()
    elseif syn and syn.protect_gui then
        local gui = Instance.new("ScreenGui")
        syn.protect_gui(gui)
        gui.Parent = CoreGui
        return gui
    else
        pcall(function()
            return CoreGui
        end)
        return Player:WaitForChild("PlayerGui")
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ä¸»åº“ç±»
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local Library = {}
Library.__index = Library

-- å›¾æ ‡é›†åˆ (ä½¿ç”¨Lucideé£æ ¼å›¾æ ‡ID)
Library.Icons = {
    Combat = "rbxassetid://7733715400",
    Movement = "rbxassetid://7733960286",
    Visual = "rbxassetid://7734053495",
    Player = "rbxassetid://7743878857",
    World = "rbxassetid://7734068854",
    Misc = "rbxassetid://7734027944",
    Settings = "rbxassetid://7734053495",
    Close = "rbxassetid://7072725342",
    Minimize = "rbxassetid://7072719338",
    Arrow = "rbxassetid://7072706620",
    Check = "rbxassetid://7072707677",
    Search = "rbxassetid://7072718894",
    Keybind = "rbxassetid://7072717857",
    Color = "rbxassetid://7072706796",
    Slider = "rbxassetid://7072718894",
}

function Library.new(title)
    local self = setmetatable({}, Library)
    
    self.Title = title or "Vape V4"
    self.Windows = {}
    self.Toggled = true
    self.ToggleKey = Enum.KeyCode.RightShift
    self.Connections = {}
    self.ActiveDropdown = nil
    
    -- åˆ›å»ºä¸» ScreenGui
    self.ScreenGui = Utility.Create("ScreenGui", {
        Name = "VapeUILibrary_" .. math.random(1000, 9999),
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999,
        IgnoreGuiInset = true,
    })
    
    -- è®¾ç½®çˆ¶çº§
    local success, err = pcall(function()
        if gethui then
            self.ScreenGui.Parent = gethui()
        elseif syn and syn.protect_gui then
            syn.protect_gui(self.ScreenGui)
            self.ScreenGui.Parent = CoreGui
        else
            self.ScreenGui.Parent = CoreGui
        end
    end)
    
    if not success then
        self.ScreenGui.Parent = Player:WaitForChild("PlayerGui")
    end
    
    -- ä¸‹æ‹‰èœå•å®¹å™¨
    self.DropdownContainer = Utility.Create("Frame", {
        Name = "DropdownContainer",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = CONFIG.ZIndex.Dropdown,
        Parent = self.ScreenGui
    })
    
    -- å…¨å±€é”®ä½ç›‘å¬
    self:SetupGlobalKeybinds()
    
    return self
end

function Library:SetupGlobalKeybinds()
    table.insert(self.Connections, UserInputService.InputBegan:Connect(function(input, processed)
        if processed then return end
        
        if input.KeyCode == self.ToggleKey then
            self.Toggled = not self.Toggled
            for _, window in ipairs(self.Windows) do
                window:SetVisible(self.Toggled)
            end
        end
    end))
end

function Library:CreateWindow(options)
    options = options or {}
    local window = Window.new(self, options)
    table.insert(self.Windows, window)
    return window
end

function Library:CreateHUD(options)
    options = options or {}
    local hud = HUD.new(self, options)
    return hud
end

function Library:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.ScreenGui:Destroy()
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- çª—å£ç±»
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Window = {}
Window.__index = Window

function Window.new(library, options)
    local self = setmetatable({}, Window)
    
    self.Library = library
    self.Title = options.Title or "Window"
    self.Size = options.Size or UDim2.new(0, CONFIG.Sizes.WindowWidth, 0, CONFIG.Sizes.WindowHeight)
    self.Tabs = {}
    self.CurrentTab = nil
    self.Minimized = false
    self.Visible = true
    
    self:Build()
    
    return self
end

function Window:Build()
    -- ä¸»çª—å£Frame
    self.Frame = Utility.Create("Frame", {
        Name = "Window",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = self.Size,
        ZIndex = CONFIG.ZIndex.Window,
        Parent = self.Library.ScreenGui
    })
    Utility.AddCorner(self.Frame, CONFIG.Sizes.CornerRadius)
    Utility.AddStroke(self.Frame, CONFIG.Theme.Tertiary)
    Utility.AddShadow(self.Frame)
    
    -- é¡¶éƒ¨æ ‡é¢˜æ 
    self.TopBar = Utility.Create("Frame", {
        Name = "TopBar",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Size = UDim2.new(1, 0, 0, 35),
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = self.Frame
    })
    Utility.AddCorner(self.TopBar, CONFIG.Sizes.CornerRadius)
    
    -- ä¿®å¤åº•éƒ¨åœ†è§’
    Utility.Create("Frame", {
        Name = "BottomFix",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(0, 0, 1, -8),
        Size = UDim2.new(1, 0, 0, 8),
        BorderSizePixel = 0,
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = self.TopBar
    })
    
    -- æ ‡é¢˜æ–‡å­—
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 0, 0),
        Size = UDim2.new(0.5, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = self.Title,
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Window + 2,
        Parent = self.TopBar
    })
    
    -- æŒ‰é’®å®¹å™¨
    local buttonContainer = Utility.Create("Frame", {
        Name = "Buttons",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -70, 0, 0),
        Size = UDim2.new(0, 65, 1, 0),
        ZIndex = CONFIG.ZIndex.Window + 2,
        Parent = self.TopBar
    })
    
    -- æœ€å°åŒ–æŒ‰é’®
    self.MinimizeButton = Utility.Create("ImageButton", {
        Name = "Minimize",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 20, 0, 20),
        Image = Library.Icons.Minimize,
        ImageColor3 = CONFIG.Theme.TextDark,
        ZIndex = CONFIG.ZIndex.Window + 3,
        Parent = buttonContainer
    })
    
    -- å…³é—­æŒ‰é’®
    self.CloseButton = Utility.Create("ImageButton", {
        Name = "Close",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 20, 0, 20),
        Image = Library.Icons.Close,
        ImageColor3 = CONFIG.Theme.TextDark,
        ZIndex = CONFIG.ZIndex.Window + 3,
        Parent = buttonContainer
    })
    
    -- å·¦ä¾§è¾¹æ 
    self.Sidebar = Utility.Create("Frame", {
        Name = "Sidebar",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(0, 0, 0, 35),
        Size = UDim2.new(0, CONFIG.Sizes.SidebarWidth, 1, -35),
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = self.Frame
    })
    
    -- ä¿®å¤ä¾§è¾¹æ åœ†è§’
    Utility.Create("Frame", {
        Name = "RightFix",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(1, -8, 0, 0),
        Size = UDim2.new(0, 8, 1, 0),
        BorderSizePixel = 0,
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = self.Sidebar
    })
    Utility.Create("Frame", {
        Name = "TopFix",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 8),
        BorderSizePixel = 0,
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = self.Sidebar
    })
    
    -- åº•éƒ¨åœ†è§’
    local sidebarCorner = Utility.Create("Frame", {
        Name = "CornerHolder",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 1, -CONFIG.Sizes.CornerRadius),
        Size = UDim2.new(1, 0, 0, CONFIG.Sizes.CornerRadius),
        ClipsDescendants = true,
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = self.Sidebar
    })
    local cornerFrame = Utility.Create("Frame", {
        Name = "Corner",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(0, 0, 0, -CONFIG.Sizes.CornerRadius),
        Size = UDim2.new(1, 0, 0, CONFIG.Sizes.CornerRadius * 2),
        ZIndex = CONFIG.ZIndex.Window + 1,
        Parent = sidebarCorner
    })
    Utility.AddCorner(cornerFrame, CONFIG.Sizes.CornerRadius)
    
    -- æ ‡ç­¾åˆ—è¡¨å¸ƒå±€
    self.TabList = Utility.Create("Frame", {
        Name = "TabList",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 10),
        Size = UDim2.new(1, 0, 1, -20),
        ZIndex = CONFIG.ZIndex.Window + 2,
        Parent = self.Sidebar
    })
    
    Utility.Create("UIListLayout", {
        Padding = UDim.new(0, 5),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = self.TabList
    })
    
    -- å†…å®¹åŒºåŸŸ
    self.ContentArea = Utility.Create("Frame", {
        Name = "ContentArea",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, CONFIG.Sizes.SidebarWidth, 0, 35),
        Size = UDim2.new(1, -CONFIG.Sizes.SidebarWidth, 1, -35),
        ZIndex = CONFIG.ZIndex.Content,
        Parent = self.Frame
    })
    
    -- è®¾ç½®æ‹–æ‹½
    self:SetupDragging()
    
    -- è®¾ç½®æŒ‰é’®äº‹ä»¶
    self:SetupButtons()
end

function Window:SetupDragging()
    local dragging, dragInput, dragStart, startPos
    
    self.TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = self.Frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    self.TopBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Utility.Tween(self.Frame, TweenInfo.new(0.08, Enum.EasingStyle.Quad), {
                Position = UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            })
        end
    end)
end

function Window:SetupButtons()
    -- æœ€å°åŒ–æŒ‰é’®æ‚¬åœæ•ˆæœ
    self.MinimizeButton.MouseEnter:Connect(function()
        Utility.Tween(self.MinimizeButton, CONFIG.Animation.Fast, {
            ImageColor3 = CONFIG.Theme.Text
        })
    end)
    self.MinimizeButton.MouseLeave:Connect(function()
        Utility.Tween(self.MinimizeButton, CONFIG.Animation.Fast, {
            ImageColor3 = CONFIG.Theme.TextDark
        })
    end)
    self.MinimizeButton.MouseButton1Click:Connect(function()
        self:ToggleMinimize()
    end)
    
    -- å…³é—­æŒ‰é’®æ‚¬åœæ•ˆæœ
    self.CloseButton.MouseEnter:Connect(function()
        Utility.Tween(self.CloseButton, CONFIG.Animation.Fast, {
            ImageColor3 = CONFIG.Theme.Disabled
        })
    end)
    self.CloseButton.MouseLeave:Connect(function()
        Utility.Tween(self.CloseButton, CONFIG.Animation.Fast, {
            ImageColor3 = CONFIG.Theme.TextDark
        })
    end)
    self.CloseButton.MouseButton1Click:Connect(function()
        self:Close()
    end)
end

function Window:ToggleMinimize()
    self.Minimized = not self.Minimized
    
    local targetSize = self.Minimized 
        and UDim2.new(0, self.Size.X.Offset, 0, 35)
        or self.Size
        
    Utility.Tween(self.Frame, CONFIG.Animation.Medium, {
        Size = targetSize
    })
    
    self.ContentArea.Visible = not self.Minimized
    self.Sidebar.Visible = not self.Minimized
end

function Window:SetVisible(visible)
    self.Visible = visible
    Utility.Tween(self.Frame, CONFIG.Animation.Fast, {
        BackgroundTransparency = visible and 0 or 1,
    })
    
    for _, descendant in ipairs(self.Frame:GetDescendants()) do
        if descendant:IsA("Frame") then
            Utility.Tween(descendant, CONFIG.Animation.Fast, {
                BackgroundTransparency = visible and (descendant.BackgroundTransparency < 1 and 0 or 1) or 1
            })
        elseif descendant:IsA("TextLabel") or descendant:IsA("TextButton") then
            Utility.Tween(descendant, CONFIG.Animation.Fast, {
                TextTransparency = visible and 0 or 1
            })
        elseif descendant:IsA("ImageLabel") or descendant:IsA("ImageButton") then
            Utility.Tween(descendant, CONFIG.Animation.Fast, {
                ImageTransparency = visible and (descendant.ImageTransparency < 1 and 0 or 1) or 1
            })
        end
    end
end

function Window:Close()
    Utility.Tween(self.Frame, CONFIG.Animation.Medium, {
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1
    }).Completed:Connect(function()
        self.Frame:Destroy()
    end)
end

function Window:AddTab(options)
    options = options or {}
    local tab = Tab.new(self, options)
    table.insert(self.Tabs, tab)
    
    if not self.CurrentTab then
        self:SelectTab(tab)
    end
    
    return tab
end

function Window:SelectTab(tab)
    -- å–æ¶ˆå½“å‰é€‰ä¸­
    if self.CurrentTab then
        self.CurrentTab:SetSelected(false)
    end
    
    -- é€‰ä¸­æ–°æ ‡ç­¾
    self.CurrentTab = tab
    tab:SetSelected(true)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- æ ‡ç­¾é¡µç±»
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Tab = {}
Tab.__index = Tab

function Tab.new(window, options)
    local self = setmetatable({}, Tab)
    
    self.Window = window
    self.Name = options.Name or "Tab"
    self.Icon = options.Icon or Library.Icons.Misc
    self.Modules = {}
    self.Selected = false
    self.ExpandedModule = nil
    
    self:Build()
    
    return self
end

function Tab:Build()
    -- æ ‡ç­¾æŒ‰é’®
    self.Button = Utility.Create("Frame", {
        Name = self.Name .. "Tab",
        BackgroundColor3 = CONFIG.Theme.Tertiary,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 45, 0, 45),
        ZIndex = CONFIG.ZIndex.Window + 3,
        Parent = self.Window.TabList
    })
    Utility.AddCorner(self.Button, CONFIG.Sizes.SmallCorner)
    
    -- å›¾æ ‡
    self.IconImage = Utility.Create("ImageLabel", {
        Name = "Icon",
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(0, 22, 0, 22),
        Image = self.Icon,
        ImageColor3 = CONFIG.Theme.TextDark,
        ZIndex = CONFIG.ZIndex.Window + 4,
        Parent = self.Button
    })
    
    -- é€‰ä¸­æŒ‡ç¤ºå™¨
    self.Indicator = Utility.Create("Frame", {
        Name = "Indicator",
        BackgroundColor3 = CONFIG.Theme.Accent,
        Position = UDim2.new(0, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 3, 0, 0),
        ZIndex = CONFIG.ZIndex.Window + 4,
        Parent = self.Button
    })
    Utility.AddCorner(self.Indicator, 2)
    
    -- å†…å®¹é¡µé¢
    self.Page = Utility.Create("ScrollingFrame", {
        Name = self.Name .. "Page",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 8),
        Size = UDim2.new(1, -16, 1, -16),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = CONFIG.Theme.Accent,
        ScrollBarImageTransparency = 0.5,
        Visible = false,
        ZIndex = CONFIG.ZIndex.Content,
        Parent = self.Window.ContentArea
    })
    
    -- æ¨¡å—åˆ—è¡¨å¸ƒå±€
    self.ModuleLayout = Utility.Create("UIListLayout", {
        Padding = UDim.new(0, 6),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = self.Page
    })
    
    Utility.Create("UIPadding", {
        PaddingBottom = UDim.new(0, 8),
        Parent = self.Page
    })
    
    -- è‡ªåŠ¨æ›´æ–° Canvas å¤§å°
    self.ModuleLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.Page.CanvasSize = UDim2.new(0, 0, 0, self.ModuleLayout.AbsoluteContentSize.Y + 16)
    end)
    
    -- ç‚¹å‡»äº‹ä»¶
    local clickDetector = Utility.Create("TextButton", {
        Name = "ClickDetector",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        ZIndex = CONFIG.ZIndex.Window + 5,
        Parent = self.Button
    })
    
    clickDetector.MouseButton1Click:Connect(function()
        self.Window:SelectTab(self)
    end)
    
    -- æ‚¬åœæ•ˆæœ
    clickDetector.MouseEnter:Connect(function()
        if not self.Selected then
            Utility.Tween(self.Button, CONFIG.Animation.Fast, {
                BackgroundTransparency = 0.5
            })
            Utility.Tween(self.IconImage, CONFIG.Animation.Fast, {
                ImageColor3 = CONFIG.Theme.Text
            })
        end
    end)
    
    clickDetector.MouseLeave:Connect(function()
        if not self.Selected then
            Utility.Tween(self.Button, CONFIG.Animation.Fast, {
                BackgroundTransparency = 1
            })
            Utility.Tween(self.IconImage, CONFIG.Animation.Fast, {
                ImageColor3 = CONFIG.Theme.TextDark
            })
        end
    end)
end

function Tab:SetSelected(selected)
    self.Selected = selected
    
    -- åŠ¨ç”»
    Utility.Tween(self.Button, CONFIG.Animation.Fast, {
        BackgroundTransparency = selected and 0 or 1
    })
    Utility.Tween(self.IconImage, CONFIG.Animation.Fast, {
        ImageColor3 = selected and CONFIG.Theme.Accent or CONFIG.Theme.TextDark
    })
    Utility.Tween(self.Indicator, CONFIG.Animation.Medium, {
        Size = UDim2.new(0, 3, selected and 0.5 or 0, 0)
    })
    
    self.Page.Visible = selected
end

function Tab:AddToggle(options)
    local toggle = Toggle.new(self, options)
    table.insert(self.Modules, toggle)
    return toggle
end

function Tab:AddLabel(options)
    local label = Label.new(self, options)
    return label
end

function Tab:AddButton(options)
    local button = Button.new(self, options)
    return button
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- å¼€å…³æ¨¡å—ç±» (æ ¸å¿ƒç»„ä»¶)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Toggle = {}
Toggle.__index = Toggle

function Toggle.new(tab, options)
    local self = setmetatable({}, Toggle)
    
    self.Tab = tab
    self.Name = options.Name or "Toggle"
    self.Description = options.Description or ""
    self.Default = options.Default or false
    self.Enabled = self.Default
    self.Callback = options.Callback or function() end
    self.Keybind = options.Keybind or nil
    self.Settings = {}
    self.SettingsExpanded = false
    self.SettingsHeight = 0
    
    self:Build()
    
    return self
end

function Toggle:Build()
    -- ä¸»å®¹å™¨
    self.Container = Utility.Create("Frame", {
        Name = self.Name .. "Toggle",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Size = UDim2.new(1, 0, 0, CONFIG.Sizes.ModuleHeight),
        ClipsDescendants = true,
        ZIndex = CONFIG.ZIndex.Content + 1,
        Parent = self.Tab.Page
    })
    Utility.AddCorner(self.Container, CONFIG.Sizes.SmallCorner)
    
    -- ä¸»æŒ‰é’®åŒºåŸŸ
    self.MainArea = Utility.Create("Frame", {
        Name = "MainArea",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, CONFIG.Sizes.ModuleHeight),
        ZIndex = CONFIG.ZIndex.Content + 2,
        Parent = self.Container
    })
    
    -- å¼€å…³æŒ‡ç¤ºå™¨
    self.ToggleIndicator = Utility.Create("Frame", {
        Name = "Indicator",
        BackgroundColor3 = self.Enabled and CONFIG.Theme.Enabled or CONFIG.Theme.Disabled,
        Position = UDim2.new(0, 12, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 4, 0, 18),
        ZIndex = CONFIG.ZIndex.Content + 3,
        Parent = self.MainArea
    })
    Utility.AddCorner(self.ToggleIndicator, 2)
    
    -- åç§°æ ‡ç­¾
    self.NameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 24, 0, 0),
        Size = UDim2.new(1, -80, 1, 0),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Content + 3,
        Parent = self.MainArea
    })
    
    -- å¿«æ·é”®æ˜¾ç¤º
    self.KeybindLabel = Utility.Create("TextLabel", {
        Name = "Keybind",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -60, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        Size = UDim2.new(0, 40, 0, 18),
        Font = Enum.Font.GothamMedium,
        Text = self.Keybind and "[" .. self.Keybind.Name .. "]" or "",
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        ZIndex = CONFIG.ZIndex.Content + 3,
        Parent = self.MainArea
    })
    
    -- å±•å¼€ç®­å¤´
    self.ExpandArrow = Utility.Create("ImageButton", {
        Name = "ExpandArrow",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -25, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(0, 16, 0, 16),
        Image = Library.Icons.Arrow,
        ImageColor3 = CONFIG.Theme.TextDark,
        Rotation = 0,
        ZIndex = CONFIG.ZIndex.Content + 3,
        Parent = self.MainArea
    })
    
    -- è®¾ç½®é¢æ¿å®¹å™¨
    self.SettingsPanel = Utility.Create("Frame", {
        Name = "SettingsPanel",
        BackgroundColor3 = CONFIG.Theme.Tertiary,
        Position = UDim2.new(0, 6, 0, CONFIG.Sizes.ModuleHeight),
        Size = UDim2.new(1, -12, 0, 0),
        ClipsDescendants = true,
        ZIndex = CONFIG.ZIndex.Settings,
        Parent = self.Container
    })
    Utility.AddCorner(self.SettingsPanel, CONFIG.Sizes.SmallCorner - 2)
    
    -- è®¾ç½®åˆ—è¡¨å¸ƒå±€
    self.SettingsLayout = Utility.Create("UIListLayout", {
        Padding = UDim.new(0, 4),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = self.SettingsPanel
    })
    
    Utility.Create("UIPadding", {
        PaddingTop = UDim.new(0, 6),
        PaddingBottom = UDim.new(0, 6),
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
        Parent = self.SettingsPanel
    })
    
    -- ç‚¹å‡»æ£€æµ‹å™¨ (å·¦é”®åˆ‡æ¢)
    local toggleDetector = Utility.Create("TextButton", {
        Name = "ToggleDetector",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, -35, 1, 0),
        Text = "",
        ZIndex = CONFIG.ZIndex.Content + 5,
        Parent = self.MainArea
    })
    
    -- å·¦é”®åˆ‡æ¢
    toggleDetector.MouseButton1Click:Connect(function()
        Utility.Ripple(self.MainArea, Mouse.X, Mouse.Y)
        self:SetEnabled(not self.Enabled)
    end)
    
    -- å³é”®å±•å¼€è®¾ç½® (æ ¸å¿ƒåŠŸèƒ½!)
    toggleDetector.MouseButton2Click:Connect(function()
        self:ToggleSettings()
    end)
    
    -- å±•å¼€ç®­å¤´ç‚¹å‡»
    self.ExpandArrow.MouseButton1Click:Connect(function()
        self:ToggleSettings()
    end)
    
    -- æ‚¬åœæ•ˆæœ
    toggleDetector.MouseEnter:Connect(function()
        Utility.Tween(self.Container, CONFIG.Animation.Fast, {
            BackgroundColor3 = CONFIG.Theme.Hover
        })
    end)
    
    toggleDetector.MouseLeave:Connect(function()
        Utility.Tween(self.Container, CONFIG.Animation.Fast, {
            BackgroundColor3 = CONFIG.Theme.Secondary
        })
    end)
    
    -- ç®­å¤´æ‚¬åœ
    self.ExpandArrow.MouseEnter:Connect(function()
        Utility.Tween(self.ExpandArrow, CONFIG.Animation.Fast, {
            ImageColor3 = CONFIG.Theme.Text
        })
    end)
    self.ExpandArrow.MouseLeave:Connect(function()
        Utility.Tween(self.ExpandArrow, CONFIG.Animation.Fast, {
            ImageColor3 = CONFIG.Theme.TextDark
        })
    end)
    
    -- ç›‘å¬è®¾ç½®é«˜åº¦å˜åŒ–
    self.SettingsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.SettingsHeight = self.SettingsLayout.AbsoluteContentSize.Y + 12
        if self.SettingsExpanded then
            self:UpdateSize()
        end
    end)
    
    -- å¿«æ·é”®ç»‘å®š
    if self.Keybind then
        UserInputService.InputBegan:Connect(function(input, processed)
            if processed then return end
            if input.KeyCode == self.Keybind then
                self:SetEnabled(not self.Enabled)
            end
        end)
    end
end

function Toggle:SetEnabled(enabled)
    self.Enabled = enabled
    
    -- æŒ‡ç¤ºå™¨é¢œè‰²
    Utility.Tween(self.ToggleIndicator, CONFIG.Animation.Fast, {
        BackgroundColor3 = enabled and CONFIG.Theme.Enabled or CONFIG.Theme.Disabled
    })
    
    -- å›è°ƒ
    task.spawn(function()
        self.Callback(enabled)
    end)
end

function Toggle:ToggleSettings()
    -- æ”¶èµ·å…¶ä»–å±•å¼€çš„æ¨¡å—
    if self.Tab.ExpandedModule and self.Tab.ExpandedModule ~= self then
        self.Tab.ExpandedModule:CollapseSettings()
    end
    
    if self.SettingsExpanded then
        self:CollapseSettings()
    else
        self:ExpandSettings()
    end
end

function Toggle:ExpandSettings()
    if #self.Settings == 0 then return end
    
    self.SettingsExpanded = true
    self.Tab.ExpandedModule = self
    
    -- æ—‹è½¬ç®­å¤´
    Utility.Tween(self.ExpandArrow, CONFIG.Animation.Medium, {
        Rotation = 180
    })
    
    -- å±•å¼€è®¾ç½®é¢æ¿
    self:UpdateSize()
end

function Toggle:CollapseSettings()
    self.SettingsExpanded = false
    if self.Tab.ExpandedModule == self then
        self.Tab.ExpandedModule = nil
    end
    
    -- æ¢å¤ç®­å¤´
    Utility.Tween(self.ExpandArrow, CONFIG.Animation.Medium, {
        Rotation = 0
    })
    
    -- æ”¶èµ·è®¾ç½®é¢æ¿
    Utility.Tween(self.Container, CONFIG.Animation.Medium, {
        Size = UDim2.new(1, 0, 0, CONFIG.Sizes.ModuleHeight)
    })
    Utility.Tween(self.SettingsPanel, CONFIG.Animation.Medium, {
        Size = UDim2.new(1, -12, 0, 0)
    })
end

function Toggle:UpdateSize()
    local totalHeight = CONFIG.Sizes.ModuleHeight + self.SettingsHeight + 6
    
    Utility.Tween(self.Container, CONFIG.Animation.Medium, {
        Size = UDim2.new(1, 0, 0, totalHeight)
    })
    Utility.Tween(self.SettingsPanel, CONFIG.Animation.Medium, {
        Size = UDim2.new(1, -12, 0, self.SettingsHeight)
    })
end

-- æ·»åŠ æ»‘å—
function Toggle:AddSlider(options)
    local slider = Slider.new(self, options)
    table.insert(self.Settings, slider)
    return slider
end

-- æ·»åŠ ä¸‹æ‹‰æ¡†
function Toggle:AddDropdown(options)
    local dropdown = Dropdown.new(self, options)
    table.insert(self.Settings, dropdown)
    return dropdown
end

-- æ·»åŠ é¢œè‰²é€‰æ‹©å™¨
function Toggle:AddColorPicker(options)
    local colorPicker = ColorPicker.new(self, options)
    table.insert(self.Settings, colorPicker)
    return colorPicker
end

-- æ·»åŠ å¿«æ·é”®ç»‘å®š
function Toggle:AddKeybind(options)
    local keybind = KeybindSetting.new(self, options)
    table.insert(self.Settings, keybind)
    return keybind
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- æ»‘å—ç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Slider = {}
Slider.__index = Slider

function Slider.new(toggle, options)
    local self = setmetatable({}, Slider)
    
    self.Toggle = toggle
    self.Name = options.Name or "Slider"
    self.Min = options.Min or 0
    self.Max = options.Max or 100
    self.Default = options.Default or self.Min
    self.Value = self.Default
    self.Increment = options.Increment or 1
    self.Callback = options.Callback or function() end
    self.Dragging = false
    
    self:Build()
    
    return self
end

function Slider:Build()
    self.Container = Utility.Create("Frame", {
        Name = self.Name .. "Slider",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 35),
        ZIndex = CONFIG.ZIndex.Settings + 1,
        Parent = self.Toggle.SettingsPanel
    })
    
    -- åç§°
    self.NameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0.5, 0, 0, 16),
        Font = Enum.Font.Gotham,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    
    -- æ•°å€¼æ˜¾ç¤º
    self.ValueLabel = Utility.Create("TextBox", {
        Name = "Value",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(1, -45, 0, 0),
        Size = UDim2.new(0, 45, 0, 16),
        Font = Enum.Font.GothamMedium,
        Text = tostring(self.Value),
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 11,
        ClearTextOnFocus = false,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    Utility.AddCorner(self.ValueLabel, 4)
    
    -- æ»‘å—è½¨é“
    self.Track = Utility.Create("Frame", {
        Name = "Track",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(0, 0, 0, 22),
        Size = UDim2.new(1, 0, 0, 8),
        ZIndex = CONFIG.ZIndex.Settings + 1,
        Parent = self.Container
    })
    Utility.AddCorner(self.Track, 4)
    
    -- æ»‘å—å¡«å……
    local fillPercentage = (self.Value - self.Min) / (self.Max - self.Min)
    self.Fill = Utility.Create("Frame", {
        Name = "Fill",
        BackgroundColor3 = CONFIG.Theme.Accent,
        Size = UDim2.new(fillPercentage, 0, 1, 0),
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Track
    })
    Utility.AddCorner(self.Fill, 4)
    
    -- æ»‘å—æŠŠæ‰‹
    self.Handle = Utility.Create("Frame", {
        Name = "Handle",
        BackgroundColor3 = CONFIG.Theme.Text,
        Position = UDim2.new(fillPercentage, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(0, 14, 0, 14),
        ZIndex = CONFIG.ZIndex.Settings + 3,
        Parent = self.Track
    })
    Utility.AddCorner(self.Handle, 7)
    Utility.AddStroke(self.Handle, CONFIG.Theme.Accent, 2)
    
    -- äº¤äº’
    self.Track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.Dragging = true
            self:UpdateFromInput(input.Position.X)
        end
    end)
    
    self.Track.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.Dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if self.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            self:UpdateFromInput(input.Position.X)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.Dragging = false
        end
    end)
    
    -- æ–‡æœ¬è¾“å…¥
    self.ValueLabel.FocusLost:Connect(function()
        local num = tonumber(self.ValueLabel.Text)
        if num then
            num = math.clamp(num, self.Min, self.Max)
            self:SetValue(num)
        else
            self.ValueLabel.Text = tostring(self.Value)
        end
    end)
end

function Slider:UpdateFromInput(mouseX)
    local trackPos = self.Track.AbsolutePosition.X
    local trackSize = self.Track.AbsoluteSize.X
    
    local percentage = math.clamp((mouseX - trackPos) / trackSize, 0, 1)
    local value = self.Min + (self.Max - self.Min) * percentage
    
    -- åº”ç”¨å¢é‡
    value = math.floor(value / self.Increment + 0.5) * self.Increment
    value = math.clamp(value, self.Min, self.Max)
    
    self:SetValue(value)
end

function Slider:SetValue(value)
    self.Value = value
    local percentage = (value - self.Min) / (self.Max - self.Min)
    
    -- æ›´æ–°UI
    Utility.Tween(self.Fill, TweenInfo.new(0.05), {
        Size = UDim2.new(percentage, 0, 1, 0)
    })
    Utility.Tween(self.Handle, TweenInfo.new(0.05), {
        Position = UDim2.new(percentage, 0, 0.5, 0)
    })
    
    self.ValueLabel.Text = tostring(value)
    
    task.spawn(function()
        self.Callback(value)
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ä¸‹æ‹‰æ¡†ç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Dropdown = {}
Dropdown.__index = Dropdown

function Dropdown.new(toggle, options)
    local self = setmetatable({}, Dropdown)
    
    self.Toggle = toggle
    self.Library = toggle.Tab.Window.Library
    self.Name = options.Name or "Dropdown"
    self.Options = options.Options or {}
    self.Default = options.Default or (self.Options[1] or "")
    self.Selected = self.Default
    self.MultiSelect = options.MultiSelect or false
    self.SelectedItems = {}
    self.Callback = options.Callback or function() end
    self.Opened = false
    
    if self.MultiSelect and type(self.Default) == "table" then
        for _, item in ipairs(self.Default) do
            self.SelectedItems[item] = true
        end
    end
    
    self:Build()
    
    return self
end

function Dropdown:Build()
    self.Container = Utility.Create("Frame", {
        Name = self.Name .. "Dropdown",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 40),
        ZIndex = CONFIG.ZIndex.Settings + 1,
        Parent = self.Toggle.SettingsPanel
    })
    
    -- åç§°
    self.NameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 16),
        Font = Enum.Font.Gotham,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    
    -- é€‰æ‹©æŒ‰é’®
    self.SelectButton = Utility.Create("TextButton", {
        Name = "Select",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(0, 0, 0, 18),
        Size = UDim2.new(1, 0, 0, 22),
        Font = Enum.Font.Gotham,
        Text = "  " .. self:GetDisplayText(),
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    Utility.AddCorner(self.SelectButton, 4)
    
    -- ä¸‹æ‹‰ç®­å¤´
    self.Arrow = Utility.Create("ImageLabel", {
        Name = "Arrow",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -18, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(0, 12, 0, 12),
        Image = Library.Icons.Arrow,
        ImageColor3 = CONFIG.Theme.TextDark,
        Rotation = 0,
        ZIndex = CONFIG.ZIndex.Settings + 3,
        Parent = self.SelectButton
    })
    
    -- ä¸‹æ‹‰åˆ—è¡¨å®¹å™¨ (åœ¨ DropdownContainer ä¸­)
    self.DropdownFrame = Utility.Create("Frame", {
        Name = self.Name .. "List",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 200, 0, 0),
        Visible = false,
        ClipsDescendants = true,
        ZIndex = CONFIG.ZIndex.Dropdown,
        Parent = self.Library.DropdownContainer
    })
    Utility.AddCorner(self.DropdownFrame, CONFIG.Sizes.SmallCorner)
    Utility.AddStroke(self.DropdownFrame, CONFIG.Theme.Tertiary)
    
    -- æœç´¢æ¡†
    self.SearchBox = Utility.Create("TextBox", {
        Name = "Search",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(0, 6, 0, 6),
        Size = UDim2.new(1, -12, 0, 22),
        Font = Enum.Font.Gotham,
        PlaceholderText = "æœç´¢...",
        PlaceholderColor3 = CONFIG.Theme.TextDark,
        Text = "",
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 11,
        ClearTextOnFocus = false,
        ZIndex = CONFIG.ZIndex.Dropdown + 1,
        Parent = self.DropdownFrame
    })
    Utility.AddCorner(self.SearchBox, 4)
    
    -- é€‰é¡¹åˆ—è¡¨
    self.OptionList = Utility.Create("ScrollingFrame", {
        Name = "Options",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 6, 0, 32),
        Size = UDim2.new(1, -12, 1, -38),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = CONFIG.Theme.Accent,
        ZIndex = CONFIG.ZIndex.Dropdown + 1,
        Parent = self.DropdownFrame
    })
    
    local listLayout = Utility.Create("UIListLayout", {
        Padding = UDim.new(0, 2),
        SortOrder = Enum.SortOrder.Name,
        Parent = self.OptionList
    })
    
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.OptionList.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
    end)
    
    -- åˆ›å»ºé€‰é¡¹
    self:RefreshOptions()
    
    -- ç‚¹å‡»äº‹ä»¶
    self.SelectButton.MouseButton1Click:Connect(function()
        self:ToggleOpen()
    end)
    
    -- æœç´¢åŠŸèƒ½
    self.SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
        self:FilterOptions(self.SearchBox.Text)
    end)
    
    -- æ‚¬åœæ•ˆæœ
    self.SelectButton.MouseEnter:Connect(function()
        Utility.Tween(self.SelectButton, CONFIG.Animation.Fast, {
            BackgroundColor3 = CONFIG.Theme.Tertiary
        })
    end)
    self.SelectButton.MouseLeave:Connect(function()
        Utility.Tween(self.SelectButton, CONFIG.Animation.Fast, {
            BackgroundColor3 = CONFIG.Theme.Background
        })
    end)
end

function Dropdown:GetDisplayText()
    if self.MultiSelect then
        local items = {}
        for item, _ in pairs(self.SelectedItems) do
            table.insert(items, item)
        end
        return #items > 0 and table.concat(items, ", ") or "æ— é€‰æ‹©"
    else
        return self.Selected or "é€‰æ‹©..."
    end
end

function Dropdown:RefreshOptions()
    for _, child in ipairs(self.OptionList:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    for i, option in ipairs(self.Options) do
        self:CreateOption(option)
    end
end

function Dropdown:CreateOption(optionName)
    local isSelected = self.MultiSelect and self.SelectedItems[optionName] or self.Selected == optionName
    
    local optionButton = Utility.Create("TextButton", {
        Name = optionName,
        BackgroundColor3 = isSelected and CONFIG.Theme.Accent or CONFIG.Theme.Tertiary,
        BackgroundTransparency = isSelected and 0 or 1,
        Size = UDim2.new(1, 0, 0, 24),
        Font = Enum.Font.Gotham,
        Text = "  " .. optionName,
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Dropdown + 2,
        Parent = self.OptionList
    })
    Utility.AddCorner(optionButton, 4)
    
    optionButton.MouseButton1Click:Connect(function()
        self:SelectOption(optionName)
    end)
    
    optionButton.MouseEnter:Connect(function()
        if not (self.MultiSelect and self.SelectedItems[optionName] or self.Selected == optionName) then
            Utility.Tween(optionButton, CONFIG.Animation.Fast, {
                BackgroundTransparency = 0.5
            })
        end
    end)
    
    optionButton.MouseLeave:Connect(function()
        local selected = self.MultiSelect and self.SelectedItems[optionName] or self.Selected == optionName
        Utility.Tween(optionButton, CONFIG.Animation.Fast, {
            BackgroundTransparency = selected and 0 or 1
        })
    end)
    
    return optionButton
end

function Dropdown:SelectOption(optionName)
    if self.MultiSelect then
        self.SelectedItems[optionName] = not self.SelectedItems[optionName]
        
        for _, child in ipairs(self.OptionList:GetChildren()) do
            if child:IsA("TextButton") then
                local selected = self.SelectedItems[child.Name]
                Utility.Tween(child, CONFIG.Animation.Fast, {
                    BackgroundColor3 = selected and CONFIG.Theme.Accent or CONFIG.Theme.Tertiary,
                    BackgroundTransparency = selected and 0 or 1
                })
            end
        end
        
        local items = {}
        for item, _ in pairs(self.SelectedItems) do
            table.insert(items, item)
        end
        
        self.SelectButton.Text = "  " .. self:GetDisplayText()
        task.spawn(function()
            self.Callback(items)
        end)
    else
        self.Selected = optionName
        self.SelectButton.Text = "  " .. optionName
        
        for _, child in ipairs(self.OptionList:GetChildren()) do
            if child:IsA("TextButton") then
                local selected = child.Name == optionName
                Utility.Tween(child, CONFIG.Animation.Fast, {
                    BackgroundColor3 = selected and CONFIG.Theme.Accent or CONFIG.Theme.Tertiary,
                    BackgroundTransparency = selected and 0 or 1
                })
            end
        end
        
        self:Close()
        task.spawn(function()
            self.Callback(optionName)
        end)
    end
end

function Dropdown:FilterOptions(query)
    query = query:lower()
    for _, child in ipairs(self.OptionList:GetChildren()) do
        if child:IsA("TextButton") then
            child.Visible = query == "" or child.Name:lower():find(query, 1, true)
        end
    end
end

function Dropdown:ToggleOpen()
    if self.Opened then
        self:Close()
    else
        self:Open()
    end
end

function Dropdown:Open()
    -- å…³é—­å…¶ä»–ä¸‹æ‹‰æ¡†
    if self.Library.ActiveDropdown and self.Library.ActiveDropdown ~= self then
        self.Library.ActiveDropdown:Close()
    end
    
    self.Opened = true
    self.Library.ActiveDropdown = self
    self.DropdownFrame.Visible = true
    
    -- å®šä½
    local buttonPos = self.SelectButton.AbsolutePosition
    local buttonSize = self.SelectButton.AbsoluteSize
    
    self.DropdownFrame.Position = UDim2.new(0, buttonPos.X, 0, buttonPos.Y + buttonSize.Y + 4)
    self.DropdownFrame.Size = UDim2.new(0, buttonSize.X, 0, 0)
    
    -- å±•å¼€åŠ¨ç”»
    local listHeight = math.min(200, #self.Options * 26 + 40)
    Utility.Tween(self.DropdownFrame, CONFIG.Animation.Medium, {
        Size = UDim2.new(0, buttonSize.X, 0, listHeight)
    })
    
    Utility.Tween(self.Arrow, CONFIG.Animation.Medium, {
        Rotation = 180
    })
end

function Dropdown:Close()
    self.Opened = false
    if self.Library.ActiveDropdown == self then
        self.Library.ActiveDropdown = nil
    end
    
    Utility.Tween(self.DropdownFrame, CONFIG.Animation.Medium, {
        Size = UDim2.new(self.DropdownFrame.Size.X.Scale, self.DropdownFrame.Size.X.Offset, 0, 0)
    }).Completed:Connect(function()
        self.DropdownFrame.Visible = false
    end)
    
    Utility.Tween(self.Arrow, CONFIG.Animation.Medium, {
        Rotation = 0
    })
    
    self.SearchBox.Text = ""
end

function Dropdown:SetOptions(options)
    self.Options = options
    self:RefreshOptions()
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- é¢œè‰²é€‰æ‹©å™¨ç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ColorPicker = {}
ColorPicker.__index = ColorPicker

function ColorPicker.new(toggle, options)
    local self = setmetatable({}, ColorPicker)
    
    self.Toggle = toggle
    self.Library = toggle.Tab.Window.Library
    self.Name = options.Name or "Color"
    self.Default = options.Default or Color3.fromRGB(255, 255, 255)
    self.Color = self.Default
    self.Rainbow = false
    self.RainbowConnection = nil
    self.Callback = options.Callback or function() end
    self.Opened = false
    
    self:Build()
    
    return self
end

function ColorPicker:Build()
    self.Container = Utility.Create("Frame", {
        Name = self.Name .. "ColorPicker",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 24),
        ZIndex = CONFIG.ZIndex.Settings + 1,
        Parent = self.Toggle.SettingsPanel
    })
    
    -- åç§°
    self.NameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, -35, 1, 0),
        Font = Enum.Font.Gotham,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    
    -- é¢œè‰²é¢„è§ˆæŒ‰é’®
    self.ColorButton = Utility.Create("TextButton", {
        Name = "ColorPreview",
        BackgroundColor3 = self.Color,
        Position = UDim2.new(1, -28, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 28, 0, 18),
        Text = "",
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    Utility.AddCorner(self.ColorButton, 4)
    Utility.AddStroke(self.ColorButton, CONFIG.Theme.Text, 1)
    
    -- é¢œè‰²é€‰æ‹©é¢æ¿
    self.PickerFrame = Utility.Create("Frame", {
        Name = "Picker",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 200, 0, 0),
        Visible = false,
        ClipsDescendants = true,
        ZIndex = CONFIG.ZIndex.Dropdown,
        Parent = self.Library.DropdownContainer
    })
    Utility.AddCorner(self.PickerFrame, CONFIG.Sizes.SmallCorner)
    Utility.AddStroke(self.PickerFrame, CONFIG.Theme.Tertiary)
    
    -- è‰²ç›¸/é¥±å’Œåº¦é€‰æ‹©åŒº
    self.SatValFrame = Utility.Create("ImageButton", {
        Name = "SatVal",
        BackgroundColor3 = self.Color,
        Position = UDim2.new(0, 8, 0, 8),
        Size = UDim2.new(1, -40, 0, 120),
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Dropdown + 1,
        Parent = self.PickerFrame
    })
    Utility.AddCorner(self.SatValFrame, 4)
    
    -- ç™½è‰²æ¸å˜
    Utility.Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
        }),
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0),
            NumberSequenceKeypoint.new(1, 1)
        }),
        Parent = self.SatValFrame
    })
    
    -- é»‘è‰²æ¸å˜è¦†ç›–
    local blackOverlay = Utility.Create("Frame", {
        Name = "BlackOverlay",
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = CONFIG.ZIndex.Dropdown + 2,
        Parent = self.SatValFrame
    })
    Utility.AddCorner(blackOverlay, 4)
    Utility.Create("UIGradient", {
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 1),
            NumberSequenceKeypoint.new(1, 0)
        }),
        Rotation = 90,
        Parent = blackOverlay
    })
    
    -- è‰²ç›¸é€‰æ‹©å™¨æŒ‡é’ˆ
    self.SatValCursor = Utility.Create("Frame", {
        Name = "Cursor",
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(0, 10, 0, 10),
        ZIndex = CONFIG.ZIndex.Dropdown + 3,
        Parent = self.SatValFrame
    })
    Utility.AddCorner(self.SatValCursor, 5)
    Utility.AddStroke(self.SatValCursor, Color3.fromRGB(0, 0, 0), 2)
    
    -- è‰²ç›¸æ¡
    self.HueBar = Utility.Create("ImageButton", {
        Name = "HueBar",
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Position = UDim2.new(1, -24, 0, 8),
        Size = UDim2.new(0, 16, 0, 120),
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Dropdown + 1,
        Parent = self.PickerFrame
    })
    Utility.AddCorner(self.HueBar, 4)
    
    -- è‰²ç›¸æ¸å˜
    Utility.Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)),
            ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
        }),
        Rotation = 90,
        Parent = self.HueBar
    })
    
    -- è‰²ç›¸æŒ‡é’ˆ
    self.HueCursor = Utility.Create("Frame", {
        Name = "Cursor",
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Position = UDim2.new(0.5, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 4, 0, 6),
        ZIndex = CONFIG.ZIndex.Dropdown + 2,
        Parent = self.HueBar
    })
    Utility.AddCorner(self.HueCursor, 2)
    Utility.AddStroke(self.HueCursor, Color3.fromRGB(0, 0, 0), 1)
    
    -- RGB è¾“å…¥æ¡†
    self.RGBContainer = Utility.Create("Frame", {
        Name = "RGBInputs",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 135),
        Size = UDim2.new(1, -16, 0, 22),
        ZIndex = CONFIG.ZIndex.Dropdown + 1,
        Parent = self.PickerFrame
    })
    
    local rgbLabels = {"R", "G", "B"}
    self.RGBInputs = {}
    for i, label in ipairs(rgbLabels) do
        local input = Utility.Create("TextBox", {
            Name = label,
            BackgroundColor3 = CONFIG.Theme.Background,
            Position = UDim2.new((i - 1) / 3, 2, 0, 0),
            Size = UDim2.new(1/3, -4, 1, 0),
            Font = Enum.Font.Gotham,
            PlaceholderText = label,
            Text = tostring(math.floor(self.Color[label == "R" and "R" or label == "G" and "G" or "B"] * 255)),
            TextColor3 = CONFIG.Theme.Text,
            TextSize = 10,
            ZIndex = CONFIG.ZIndex.Dropdown + 2,
            Parent = self.RGBContainer
        })
        Utility.AddCorner(input, 4)
        self.RGBInputs[label] = input
        
        input.FocusLost:Connect(function()
            self:UpdateFromRGB()
        end)
    end
    
    -- å½©è™¹æ¨¡å¼å¼€å…³
    self.RainbowToggle = Utility.Create("TextButton", {
        Name = "Rainbow",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(0, 8, 0, 162),
        Size = UDim2.new(1, -16, 0, 22),
        Font = Enum.Font.Gotham,
        Text = "ğŸŒˆ å½©è™¹æ¨¡å¼",
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Dropdown + 1,
        Parent = self.PickerFrame
    })
    Utility.AddCorner(self.RainbowToggle, 4)
    
    -- äº‹ä»¶ç»‘å®š
    self.ColorButton.MouseButton1Click:Connect(function()
        self:ToggleOpen()
    end)
    
    self.RainbowToggle.MouseButton1Click:Connect(function()
        self:ToggleRainbow()
    end)
    
    -- è‰²ç›¸/é¥±å’Œåº¦æ‹–æ‹½
    local draggingSatVal = false
    self.SatValFrame.MouseButton1Down:Connect(function()
        draggingSatVal = true
    end)
    
    local draggingHue = false
    self.HueBar.MouseButton1Down:Connect(function()
        draggingHue = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSatVal = false
            draggingHue = false
        end
    end)
    
    RunService.RenderStepped:Connect(function()
        if draggingSatVal then
            self:UpdateSatVal()
        elseif draggingHue then
            self:UpdateHue()
        end
    end)
end

function ColorPicker:UpdateSatVal()
    local pos = self.SatValFrame.AbsolutePosition
    local size = self.SatValFrame.AbsoluteSize
    local mousePos = UserInputService:GetMouseLocation()
    
    local sat = math.clamp((mousePos.X - pos.X) / size.X, 0, 1)
    local val = 1 - math.clamp((mousePos.Y - pos.Y) / size.Y, 0, 1)
    
    self.SatValCursor.Position = UDim2.new(sat, 0, 1 - val, 0)
    
    local h, _, _ = Color3.toHSV(self.Color)
    self:SetColor(Color3.fromHSV(h, sat, val))
end

function ColorPicker:UpdateHue()
    local pos = self.HueBar.AbsolutePosition
    local size = self.HueBar.AbsoluteSize
    local mousePos = UserInputService:GetMouseLocation()
    
    local hue = math.clamp((mousePos.Y - pos.Y) / size.Y, 0, 1)
    
    self.HueCursor.Position = UDim2.new(0.5, 0, hue, 0)
    
    local _, s, v = Color3.toHSV(self.Color)
    self:SetColor(Color3.fromHSV(hue, s, v))
    
    -- æ›´æ–°é¥±å’Œåº¦åŒºèƒŒæ™¯è‰²
    self.SatValFrame.BackgroundColor3 = Color3.fromHSV(hue, 1, 1)
end

function ColorPicker:UpdateFromRGB()
    local r = math.clamp(tonumber(self.RGBInputs["R"].Text) or 255, 0, 255)
    local g = math.clamp(tonumber(self.RGBInputs["G"].Text) or 255, 0, 255)
    local b = math.clamp(tonumber(self.RGBInputs["B"].Text) or 255, 0, 255)
    
    self:SetColor(Color3.fromRGB(r, g, b))
end

function ColorPicker:SetColor(color)
    self.Color = color
    self.ColorButton.BackgroundColor3 = color
    
    -- æ›´æ–° RGB è¾“å…¥
    self.RGBInputs["R"].Text = tostring(math.floor(color.R * 255))
    self.RGBInputs["G"].Text = tostring(math.floor(color.G * 255))
    self.RGBInputs["B"].Text = tostring(math.floor(color.B * 255))
    
    task.spawn(function()
        self.Callback(color)
    end)
end

function ColorPicker:ToggleRainbow()
    self.Rainbow = not self.Rainbow
    
    self.RainbowToggle.BackgroundColor3 = self.Rainbow and CONFIG.Theme.Accent or CONFIG.Theme.Background
    self.RainbowToggle.TextColor3 = self.Rainbow and CONFIG.Theme.Text or CONFIG.Theme.TextDark
    
    if self.Rainbow then
        self.RainbowConnection = RunService.RenderStepped:Connect(function()
            local hue = (tick() % 5) / 5
            self:SetColor(Color3.fromHSV(hue, 1, 1))
        end)
    else
        if self.RainbowConnection then
            self.RainbowConnection:Disconnect()
            self.RainbowConnection = nil
        end
    end
end

function ColorPicker:ToggleOpen()
    if self.Opened then
        self:Close()
    else
        self:Open()
    end
end

function ColorPicker:Open()
    self.Opened = true
    self.PickerFrame.Visible = true
    
    local buttonPos = self.ColorButton.AbsolutePosition
    local buttonSize = self.ColorButton.AbsoluteSize
    
    self.PickerFrame.Position = UDim2.new(0, buttonPos.X - 170, 0, buttonPos.Y + buttonSize.Y + 4)
    
    Utility.Tween(self.PickerFrame, CONFIG.Animation.Medium, {
        Size = UDim2.new(0, 200, 0, 192)
    })
end

function ColorPicker:Close()
    self.Opened = false
    
    Utility.Tween(self.PickerFrame, CONFIG.Animation.Medium, {
        Size = UDim2.new(0, 200, 0, 0)
    }).Completed:Connect(function()
        self.PickerFrame.Visible = false
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- å¿«æ·é”®ç»‘å®šç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
KeybindSetting = {}
KeybindSetting.__index = KeybindSetting

function KeybindSetting.new(toggle, options)
    local self = setmetatable({}, KeybindSetting)
    
    self.Toggle = toggle
    self.Name = options.Name or "Keybind"
    self.Default = options.Default
    self.Key = self.Default
    self.Callback = options.Callback or function() end
    self.Listening = false
    
    self:Build()
    
    return self
end

function KeybindSetting:Build()
    self.Container = Utility.Create("Frame", {
        Name = self.Name .. "Keybind",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 24),
        ZIndex = CONFIG.ZIndex.Settings + 1,
        Parent = self.Toggle.SettingsPanel
    })
    
    -- åç§°
    self.NameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, -55, 1, 0),
        Font = Enum.Font.Gotham,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    
    -- ç»‘å®šæŒ‰é’®
    self.KeyButton = Utility.Create("TextButton", {
        Name = "KeyButton",
        BackgroundColor3 = CONFIG.Theme.Background,
        Position = UDim2.new(1, -50, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 50, 0, 18),
        Font = Enum.Font.GothamMedium,
        Text = self.Key and self.Key.Name or "æ— ",
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 10,
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Settings + 2,
        Parent = self.Container
    })
    Utility.AddCorner(self.KeyButton, 4)
    
    -- ç‚¹å‡»ç»‘å®š
    self.KeyButton.MouseButton1Click:Connect(function()
        self:StartListening()
    end)
    
    -- è¾“å…¥ç›‘å¬
    UserInputService.InputBegan:Connect(function(input, processed)
        if self.Listening then
            if input.KeyCode == Enum.KeyCode.Escape then
                self:SetKey(nil)
            elseif input.KeyCode ~= Enum.KeyCode.Unknown then
                self:SetKey(input.KeyCode)
            end
            self.Listening = false
            self.KeyButton.Text = self.Key and self.Key.Name or "æ— "
        end
    end)
end

function KeybindSetting:StartListening()
    self.Listening = true
    self.KeyButton.Text = "..."
end

function KeybindSetting:SetKey(key)
    self.Key = key
    self.KeyButton.Text = key and key.Name or "æ— "
    
    task.spawn(function()
        self.Callback(key)
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- æŒ‰é’®ç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Button = {}
Button.__index = Button

function Button.new(tab, options)
    local self = setmetatable({}, Button)
    
    self.Tab = tab
    self.Name = options.Name or "Button"
    self.Callback = options.Callback or function() end
    
    self:Build()
    
    return self
end

function Button:Build()
    self.Container = Utility.Create("TextButton", {
        Name = self.Name .. "Button",
        BackgroundColor3 = CONFIG.Theme.Secondary,
        Size = UDim2.new(1, 0, 0, CONFIG.Sizes.ModuleHeight),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.Text,
        TextSize = 13,
        AutoButtonColor = false,
        ZIndex = CONFIG.ZIndex.Content + 1,
        Parent = self.Tab.Page
    })
    Utility.AddCorner(self.Container, CONFIG.Sizes.SmallCorner)
    
    self.Container.MouseButton1Click:Connect(function()
        Utility.Ripple(self.Container, Mouse.X, Mouse.Y)
        task.spawn(self.Callback)
    end)
    
    self.Container.MouseEnter:Connect(function()
        Utility.Tween(self.Container, CONFIG.Animation.Fast, {
            BackgroundColor3 = CONFIG.Theme.Hover
        })
    end)
    
    self.Container.MouseLeave:Connect(function()
        Utility.Tween(self.Container, CONFIG.Animation.Fast, {
            BackgroundColor3 = CONFIG.Theme.Secondary
        })
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- æ ‡ç­¾ç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Label = {}
Label.__index = Label

function Label.new(tab, options)
    local self = setmetatable({}, Label)
    
    self.Tab = tab
    self.Text = options.Text or "Label"
    
    self:Build()
    
    return self
end

function Label:Build()
    self.Container = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 25),
        Font = Enum.Font.GothamBold,
        Text = self.Text,
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.Content + 1,
        Parent = self.Tab.Page
    })
end

function Label:SetText(text)
    self.Text = text
    self.Container.Text = text
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- HUD / æ°´å°ç»„ä»¶
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HUD = {}
HUD.__index = HUD

function HUD.new(library, options)
    local self = setmetatable({}, HUD)
    
    self.Library = library
    self.Name = options.Name or "Vape V4"
    self.ShowFPS = options.ShowFPS ~= false
    self.ShowPing = options.ShowPing ~= false
    self.Position = options.Position or UDim2.new(0, 10, 0, 10)
    
    self:Build()
    
    return self
end

function HUD:Build()
    self.Frame = Utility.Create("Frame", {
        Name = "HUD",
        BackgroundColor3 = CONFIG.Theme.Background,
        BackgroundTransparency = 0.3,
        Position = self.Position,
        Size = UDim2.new(0, 150, 0, 50),
        ZIndex = CONFIG.ZIndex.HUD,
        Parent = self.Library.ScreenGui
    })
    Utility.AddCorner(self.Frame, CONFIG.Sizes.SmallCorner)
    Utility.AddStroke(self.Frame, CONFIG.Theme.Accent, 1)
    
    -- åç§°
    self.NameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 5),
        Size = UDim2.new(1, -20, 0, 20),
        Font = Enum.Font.GothamBold,
        Text = self.Name,
        TextColor3 = CONFIG.Theme.Accent,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.HUD + 1,
        Parent = self.Frame
    })
    
    -- FPS / Ping æ˜¾ç¤º
    self.StatsLabel = Utility.Create("TextLabel", {
        Name = "Stats",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 25),
        Size = UDim2.new(1, -20, 0, 20),
        Font = Enum.Font.Gotham,
        Text = "FPS: -- | Ping: --",
        TextColor3 = CONFIG.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = CONFIG.ZIndex.HUD + 1,
        Parent = self.Frame
    })
    
    -- æ›´æ–°ç»Ÿè®¡
    local lastUpdate = 0
    local frameCount = 0
    local fps = 0
    
    RunService.RenderStepped:Connect(function(deltaTime)
        frameCount = frameCount + 1
        lastUpdate = lastUpdate + deltaTime
        
        if lastUpdate >= 0.5 then
            fps = math.floor(frameCount / lastUpdate)
            frameCount = 0
            lastUpdate = 0
            
            local ping = math.floor(Player:GetNetworkPing() * 1000)
            
            local statsText = ""
            if self.ShowFPS then
                statsText = statsText .. "FPS: " .. fps
            end
            if self.ShowPing then
                if self.ShowFPS then
                    statsText = statsText .. " | "
                end
                statsText = statsText .. "Ping: " .. ping .. "ms"
            end
            
            self.StatsLabel.Text = statsText
        end
    end)
end

function HUD:SetVisible(visible)
    self.Frame.Visible = visible
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- è¿”å›åº“
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
return Library
